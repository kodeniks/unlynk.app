(this["webpackJsonp@kodeniks/unlynk"]=this["webpackJsonp@kodeniks/unlynk"]||[]).push([[0],{212:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a=function(e,t){return e.map((function(e){return e[t]})).map((function(e,t,n){return n.indexOf(e)===t&&t})).filter((function(e){return!1!==e})).map((function(t){return e[t]}))}},213:function(e,t,n){"use strict";var a=n(277),r=new(n.n(a).a),c={on:function(e,t){return r.on(e,t)},once:function(e,t){return r.once(e,t)},off:function(e,t){return r.off(e,t)},emit:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return r.emit.apply(r,[e].concat(n))}};Object.freeze(c)},214:function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return b})),n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return f}));var a=n(10),r=n.n(a),c=n(13),s=n(94),o=n.n(s),i="ECDH",l="P-384",u=function(e,t){return o.a.decrypt(e,t)},d=function(e){if(!e)return new Uint8Array;for(var t=[],n=0,a=e.length;n<a;n+=2)t.push(parseInt(e.substr(n,2),16));return new Uint8Array(t)},j=function(e){return Array.from(new Uint8Array(e)).map((function(e){return"00".concat(e.toString(16)).slice(-2)})).join("")},b=function(){var e=Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:i,namedCurve:l},!0,["deriveKey","deriveBits"]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(c.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.exportKey("pkcs8",t.privateKey);case 2:return n=e.sent,e.next=5,window.crypto.subtle.exportKey("raw",t.publicKey);case 5:return a=e.sent,e.abrupt("return",{privateKey:j(n),publicKey:j(a)});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=Object(c.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d(t),e.next=3,window.crypto.subtle.importKey("pkcs8",n,{name:i,namedCurve:l},!1,["deriveKey","deriveBits"]);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(c.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d(t),e.next=3,window.crypto.subtle.importKey("raw",n,{name:i,namedCurve:l},!0,[]);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(c.a)(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.deriveBits({name:i,public:n},t,256);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=Object(c.a)(r.a.mark((function e(t,n,a,c){var s,o,i,l,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=u(t,n),e.next=4,O(s);case 4:return o=e.sent,i=c.find((function(e){return e.owner===a})),e.next=8,h(null===i||void 0===i?void 0:i.value);case 8:return l=e.sent,e.next=11,m(o,l);case 11:return d=e.sent,e.abrupt("return",j(d));case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return","");case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n,a,r){return e.apply(this,arguments)}}()},264:function(e,t){},412:function(e,t){},414:function(e,t){},424:function(e,t){},426:function(e,t){},453:function(e,t){},455:function(e,t){},456:function(e,t){},461:function(e,t){},463:function(e,t){},482:function(e,t){},49:function(e,t,n){"use strict";var a=n(212);n.d(t,"getUniqueByProp",(function(){return a.a}));n(213);var r=n(214);n.d(t,"computeSharedKeyString",(function(){return r.a})),n.d(t,"convertCryptoKeyPairToHex",(function(){return r.b})),n.d(t,"decrypt",(function(){return r.c})),n.d(t,"generateCryptoKeyPair",(function(){return r.d}));n(264)},494:function(e,t){},497:function(e,t){},501:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"common",(function(){return o})),n.d(a,"routes",(function(){return i}));n(296),n(502);var r=n(265),c=n(280),s=n(537),o={buttonText:{ok:"OK",cancel:"Cancel",next:"Next",back:"Back",complete:"Complete",unlock:"Unlock"}},i={},l={"en-US":a},u=(c.a.use(r.a).use(s.a).init({preload:["en-US"],resources:l,fallbackLng:"en-US",ns:["common"],defaultNS:"common",debug:!1,interpolation:{escapeValue:!1}}),n(10)),d=n.n(u),j=n(7),b=n(13),p=n(9),O=n(0),h=n.n(O),m=n(55),f=function(e){var t=Object(O.useRef)(e);return Object(O.useEffect)((function(){t.current=e}),[e]),t.current},x=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(O.useState)([]),a=Object(p.a)(n,2),r=a[0],c=a[1],s=Object(O.useState)(!0),o=Object(p.a)(s,2),i=o[0],l=o[1],u=f(e);return Object(O.useEffect)((function(){u.isEqual(e)||c([])}),[u,e]),Object(O.useEffect)((function(){return e.onSnapshot((function(e){var t=e.docs.map((function(e){return Object(j.a)(Object(j.a)({},e.data()),{},{id:e.id})}));c(t),i&&l(!1)}),(function(e){t&&console.error(e),c([]),l(!1)}))}),[i,e,t]),{docs:r,loading:i}},g=n(23),v=function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localStorage";Object(g.a)(this,e),this.namespace=void 0,this.storageLocation=void 0,this.getItem=function(e){return n.storageLocation.getItem("".concat(n.namespace,":").concat(e))},this.setItem=function(e,t){n.storageLocation.setItem("".concat(n.namespace,":").concat(e),t.toString())},this.getItemJSON=function(e){var t=n.getItem(e);if(t)try{return JSON.parse(t)}catch(a){return console.error(a),{}}return{}},this.setItemJSON=function(e,t){n.setItem(e,JSON.stringify(t))},this.removeItem=function(e){n.storageLocation.removeItem("".concat(n.namespace,":").concat(e))},this.clear=function(){n.storageLocation.clear()},this.clearNamespace=function(){for(var e=0;e<n.storageLocation.length;e++){var t=n.storageLocation.key(e);t&&t.startsWith("".concat(n.namespace,":"))&&n.storageLocation.removeItem(t)}},this.namespace=t,this.storageLocation=window[a]},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unlynk",t=arguments.length>1?arguments[1]:void 0,n=Object(O.useState)((function(){return new v(e,t)})),a=Object(p.a)(n,1),r=a[0];return r},k=n(50),C=n(538),S=n(552),w=n(284),N=n(593),I=n(79),E=n(553),T=n(550),A=n(554),R=n(48),P=n(65),U=n(1),D=Object(O.memo)((function(e){var t=e.className,n=e.id,a=e.children,r=e.FormProps,c=void 0===r?{}:r,s=e.enableReinitialize,o=void 0===s||s,i=Object(R.a)(e,["className","id","children","FormProps","enableReinitialize"]);return Object(U.jsx)(P.b,Object(j.a)(Object(j.a)({enableReinitialize:o},i),{},{children:Object(U.jsx)(P.a,Object(j.a)(Object(j.a)({"data-testid":"ui:form",className:t,id:n,noValidate:!0},c),{},{children:a}))}))})),L=n(540),M=n(600),F=n(541),K=n(542),B=n(543),_=Object(C.a)((function(e){return{formHelperText:{display:"flex",alignItems:"center"}}})),Y=Object(O.memo)((function(e){var t,n=e.id,a=e.label,r=e.helperText,c=e.FormControlProps,s=void 0===c?{}:c,o=e.InputProps,i=void 0===o?{}:o,l=Object(R.a)(e,["id","label","helperText","FormControlProps","InputProps"]),u=Object(P.c)(e),d=Object(p.a)(u,2),b=d[0],O=d[1],h=Object(P.d)(),m=_();return Object(U.jsx)(N.a,{mb:2,children:Object(U.jsxs)(L.a,Object(j.a)(Object(j.a)({disabled:h.isSubmitting,"data-testid":"ui:forminput"},s),{},{children:[Object(U.jsx)(M.a,{htmlFor:n,children:a}),Object(U.jsx)(F.a,Object(j.a)(Object(j.a)(Object(j.a)({id:n},Object(j.a)(Object(j.a)({},i),{},{inputProps:Object(j.a)({"data-testid":"ui:forminput:input"},null!==(t=i.inputProps)&&void 0!==t?t:{})})),b),l)),Object(U.jsx)(K.a,{className:m.formHelperText,"aria-live":"polite",error:O.touched&&!!O.error,children:O.touched&&O.error?Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(B.a,{fontSize:"small"}),O.error]}):Object(U.jsx)(U.Fragment,{children:r})})]}))})})),W=n(545),H=n(546),G=n(547),q=n(548),z=n(549),V=n(26),J={single:"Delete this message?",recipient:"Delete all messages to this person?",nuclear:"Delever every message you've ever sent?"},X=function(e){var t=e.type,n=e.recipientID,a=e.messageID,r=e.open,c=e.onClose,s=e.onConfirm,o=Nn(),i=Object(V.b)(),l=gn(),u=Object(O.useCallback)(Object(b.a)(d.a.mark((function e(){var r,c,u,j,b,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return");case 2:e.prev=2,e.t0=t,e.next="nuclear"===e.t0?6:"recipient"===e.t0?18:"single"===e.t0?31:34;break;case 6:return r=l.batch(),e.next=9,l.collection("messages").where("sender","==",o.uid);case 9:return c=e.sent,e.next=12,c.get();case 12:return u=e.sent,u.docs.forEach((function(e){r.delete(e.ref)})),e.next=17,r.commit();case 17:return e.abrupt("break",34);case 18:if(!n){e.next=30;break}return j=l.batch(),e.next=22,l.collection("messages").where("sender","==",o.uid).where("recipient","==",n);case 22:return b=e.sent,e.next=25,b.get();case 25:return p=e.sent,p.docs.forEach((function(e){j.delete(e.ref)})),e.next=30,j.commit();case 30:return e.abrupt("break",34);case 31:return e.next=33,l.collection("messages").doc(a).delete();case 33:return e.abrupt("break",34);case 34:e.next=39;break;case 36:e.prev=36,e.t1=e.catch(2),i.enqueueSnackbar("Deletion failed. ".concat(e.t1.message),{variant:"error"});case 39:s();case 40:case"end":return e.stop()}}),e,null,[[2,36]])}))),[o,s,t,n,l,a,i]);return Object(U.jsxs)(W.a,{open:r,onClose:c,children:[Object(U.jsx)(H.a,{id:"responsive-dialog-delete",children:J[t]}),Object(U.jsx)(G.a,{children:Object(U.jsx)(q.a,{children:"Are you sure?"})}),Object(U.jsxs)(z.a,{children:[Object(U.jsx)(T.a,{onClick:c,color:"primary",children:"Cancel"}),Object(U.jsx)(T.a,{onClick:u,color:"primary",children:"OK"})]})]})},$=function(e){var t=e.open,n=e.onClose,a=e.onConfirm;return Object(U.jsxs)(W.a,{open:t,onClose:n,children:[Object(U.jsx)(H.a,{id:"responsive-dialog-security",children:"Start Message"}),Object(U.jsx)(G.a,{children:Object(U.jsx)(yt,{onConfirm:a})}),Object(U.jsx)(z.a,{children:Object(U.jsx)(T.a,{onClick:n,color:"primary",children:"Cancel"})})]})},Q=n(34),Z=n(551),ee=function(e){var t=e.open,n=e.onClose,a=Object(Q.a)(),r=Object(Z.a)(a.breakpoints.down("sm"));return Object(U.jsxs)(W.a,{fullScreen:r,open:t,onClose:n,children:[Object(U.jsx)(H.a,{id:"responsive-dialog-security",children:"Privacy Policy"}),Object(U.jsx)(G.a,{children:Object(U.jsx)(It,{isDialog:!0})}),Object(U.jsx)(z.a,{children:Object(U.jsx)(T.a,{onClick:n,color:"primary",children:"OK"})})]})},te=function(e){var t=e.open,n=e.onCancel,a=e.onConfirm,r=Nn(),c=Object(V.b)(),s=Object(O.useCallback)(Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!r){e.next=4;break}return e.next=4,kn(r);case 4:a(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),c.enqueueSnackbar("Deletion failed. ".concat(e.t0.message),{variant:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[a,c,r]),o=Object(Q.a)(),i=Object(Z.a)(o.breakpoints.down("sm"));return Object(U.jsxs)(W.a,{fullScreen:i,open:t,onClose:n,children:[Object(U.jsx)(H.a,{id:"responsive-dialog-delete",children:"Purge account?"}),Object(U.jsxs)(G.a,{children:[Object(U.jsx)(q.a,{children:"Where to begin?"}),(null===r||void 0===r?void 0:r.isAnonymous)&&Object(U.jsxs)(q.a,{children:['First you are seeing this message because you are an anonymous user and you clicked "',Object(U.jsx)("strong",{children:"Sign-out"}),'"']}),Object(U.jsxs)(q.a,{children:['If you click "',Object(U.jsx)("strong",{children:"OK"}),'" your entire account will be deleted.']}),Object(U.jsx)(q.a,{children:"This means every message you ever sent or received, your cyrpto keys and your user info."}),Object(U.jsxs)(q.a,{children:['Are you sure? If not just click "',Object(U.jsx)("strong",{children:"Cancel"}),'" and continue on your way.']})]}),Object(U.jsxs)(z.a,{children:[Object(U.jsx)(T.a,{onClick:n,color:"primary",children:"Cancel"}),Object(U.jsx)(T.a,{onClick:s,color:"primary",children:"OK"})]})]})},ne=function(e){var t=e.open,n=e.onClose,a=Object(Q.a)(),r=Object(Z.a)(a.breakpoints.down("sm"));return Object(U.jsxs)(W.a,{fullScreen:r,open:t,onClose:n,children:[Object(U.jsx)(H.a,{id:"responsive-dialog-security",children:"Terms of Service"}),Object(U.jsx)(G.a,{children:Object(U.jsx)(Rt,{isDialog:!0})}),Object(U.jsx)(z.a,{children:Object(U.jsx)(T.a,{onClick:n,color:"primary",children:"OK"})})]})},ae=n(31),re=Object(C.a)((function(e){return{form:{width:"100%"},button:{marginBottom:e.spacing(1)},unlock:{filter:"blur(5px)",transition:"filter .1s ease","&:hover":{filter:"none"}},container:{height:"calc(100% - 4em)",display:"flex",flexDirection:"column",overflow:"hidden",overflowY:"auto"},box:{display:"flex",flexDirection:"column"},paragraph:{marginBottom:e.spacing(1)},paper:{marginBottom:e.spacing(1)}}})),ce={fullWidth:!0},se=k.a({displayName:k.b().max(32).trim()}),oe="displayNameForm",ie=function(){var e,t=Sn(),n=t.user,a=t.userAuth,r=Object(O.useState)({displayName:null!==(e=null===n||void 0===n?void 0:n.displayName)&&void 0!==e?e:""}),c=Object(p.a)(r,2),s=c[0],o=c[1];Object(O.useEffect)((function(){var e;n&&o({displayName:null!==(e=n.displayName)&&void 0!==e?e:""})}),[n]);var i=re(),l=xn(),u=gn(),j=Object(ae.g)(),h=Object(V.b)(),m=Object(O.useRef)(null),f=Object(O.useCallback)(Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.auth().sendPasswordResetEmail(null===a||void 0===a?void 0:a.email);case 3:h.enqueueSnackbar("Request sent. Please check your e-mail.",{variant:"success"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),h.enqueueSnackbar(e.t0.message,{variant:"error",autoHideDuration:2500});case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),[l,h,null===a||void 0===a?void 0:a.email]),x=Object(O.useCallback)((function(){var e;null===(e=m.current)||void 0===e||e.select(),window.document.execCommand("copy"),h.enqueueSnackbar("Copied to clipboard.",{variant:"success"})}),[h]),g=Object(O.useState)(!1),v=Object(p.a)(g,2),y=v[0],k=v[1],C=Object(O.useCallback)((function(){k(!1),j.push("/app")}),[j]),R=Object(O.useCallback)((function(){k(!1),j.push("/app")}),[j]),P=Object(O.useCallback)((function(){k(!0)}),[]),L=Object(O.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setSubmitting,!a){e.next=6;break}return e.next=4,a.updateProfile({displayName:t.displayName||null});case 4:return e.next=6,u.collection("users").doc(a.uid).set({displayName:t.displayName||null},{merge:!0});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[u,a]);return Object(U.jsxs)(S.a,{className:i.container,children:[Object(U.jsxs)(be,{severity:"info",children:["Your ",Object(U.jsx)("strong",{children:"Account ID"})," can be shared with another user to begin a conversation."]}),Object(U.jsx)(w.a,{className:i.paper,children:Object(U.jsxs)(N.a,{className:i.box,margin:1,children:[Object(U.jsx)("textarea",{readOnly:!0,ref:m,value:null===a||void 0===a?void 0:a.uid,style:{opacity:0,height:0}}),Object(U.jsxs)(I.a,{variant:"body2",children:[null===a||void 0===a?void 0:a.uid," ",Object(U.jsx)(E.a,{onClick:x,children:Object(U.jsx)(A.a,{})})]}),!(null===a||void 0===a?void 0:a.isAnonymous)&&Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(N.a,{marginBottom:2,children:Object(U.jsxs)(I.a,{children:["If you've forgotten your password click \"",Object(U.jsx)("strong",{children:"Reset Password"}),'" and en email will be sent to your registered address']})}),Object(U.jsx)(T.a,{variant:"contained",color:"primary",className:i.button,onClick:f,children:"Reset Password"})]})]})}),Object(U.jsx)(w.a,{className:i.paper,children:Object(U.jsxs)(N.a,{className:i.box,margin:1,children:[Object(U.jsx)(I.a,{className:i.paragraph,children:"You can choose to enter a display name in order to better help your friends identity you in their list."}),Object(U.jsxs)(N.a,{marginBottom:2,children:[Object(U.jsx)(I.a,{className:i.paragraph,children:"Please enter your optional display name."}),Object(U.jsx)(D,{className:i.form,id:oe,initialValues:s,onSubmit:L,validationSchema:se,children:Object(U.jsx)(Y,{id:"displayName",name:"displayName",label:"name",FormControlProps:ce})})]}),Object(U.jsx)(T.a,{type:"submit",form:oe,variant:"contained",color:"primary",children:"Update"})]})}),Object(U.jsx)(w.a,{className:i.paper,children:Object(U.jsxs)(N.a,{className:i.box,margin:1,children:[Object(U.jsx)(N.a,{marginBottom:2,children:Object(U.jsxs)(I.a,{children:[Object(U.jsx)("strong",{children:"Read"})," the dialog if you want to delete your account."]})}),Object(U.jsx)(T.a,{variant:"contained",color:"secondary",onClick:P,children:"Delete Account"})]})}),Object(U.jsx)(te,{open:y,onCancel:R,onConfirm:C})]})},le=Object(O.memo)((function(e){var t=e.borderColor,n=Object(R.a)(e,["borderColor"]),a=Object(Q.a)(),r=t?{border:"1px solid ".concat(a.palette[t].main)}:void 0;return Object(U.jsx)(w.a,Object(j.a)(Object(j.a)({},n),{},{style:r}))})),ue=n(596),de=n(555),je=Object(C.a)((function(e){return{alert:{marginBottom:e.spacing(1)}}})),be=Object(O.memo)((function(e){var t=e.title,n=e.children,a=Object(R.a)(e,["title","children"]),r=je();return Object(U.jsxs)(ue.a,Object(j.a)(Object(j.a)({className:r.alert},a),{},{children:[t&&Object(U.jsx)(de.a,{children:t}),n]}))})),pe=n(285),Oe=Object(C.a)((function(e){return{root:{position:"fixed",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",top:0,left:0,bottom:0,right:0,overflow:"auto",zIndex:1337,backgroundColor:e.palette.background.paper},logo:{width:"16em"}}})),he=Object(O.memo)((function(e){var t=e.loading,n=e.children,a=Oe();return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(pe.a,{in:t,timeout:{appear:0,exit:250},children:Object(U.jsx)("div",{className:a.root,children:Object(U.jsx)("img",{className:a.logo,src:"logo.png",alt:"logo"})})}),!t&&n]})})),me=n(35),fe=n(29),xe=n(510),ge=n(556),ve=n(49),ye=n(94),ke=Object(C.a)((function(e){return{search:Object(me.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(fe.c)("dark"===e.palette.type?e.palette.common.white:e.palette.common.black,.085),"&:hover":{backgroundColor:Object(fe.c)("dark"===e.palette.type?e.palette.common.white:e.palette.common.black,.17)},marginRight:e.spacing(2),width:"100%",flex:1},e.breakpoints.up("sm"),{width:"auto"}),messageLength:{marginRight:e.spacing(2)},inputRoot:{color:"inherit",width:"100%"},inputInput:{padding:e.spacing(1),width:"100%"}}})),Ce=Object(O.memo)((function(e){var t,n,a=e.user,r=e.selectedUserID,c=Mn(),s=c.puk,o=c.privateKey,i=c.publicKey,l=c.publicKeys,u=Object(V.b)(),j=ke(),h=Object(O.useRef)(null),f=Object(O.useState)(""),x=Object(p.a)(f,2),g=x[0],v=x[1],y=Object(O.useState)(!1),k=Object(p.a)(y,2),C=k[0],S=k[1],w=Object(O.useCallback)(Object(b.a)(d.a.mark((function e(){var t,n,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.trim()){e.next=2;break}return e.abrupt("return");case 2:if(s){e.next=5;break}return u.enqueueSnackbar("You haven't created a PUK. Please visit the dashboard.",{variant:"error",title:"Unable to send message.",autoHideDuration:5e3}),e.abrupt("return");case 5:if(o&&i){e.next=8;break}return u.enqueueSnackbar("You haven't created your CryptoKeyPair yet. Please visit the dashboard.",{variant:"error",title:"Unable to send message.",autoHideDuration:5e3}),e.abrupt("return");case 8:return S(!0),e.prev=9,e.next=12,Object(ve.computeSharedKeyString)(s,o.value,r,l);case 12:if(!(n=e.sent)){e.next=20;break}return c={created:m.a.firestore.FieldValue.serverTimestamp(),value:Object(ye.encrypt)(n,g),sender:a.uid,recipient:r},e.next=17,vn(c);case 17:v(""),e.next=21;break;case 20:u.enqueueSnackbar("Encryption Failed. Is your PUK correct?",{variant:"error"});case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(9),u.enqueueSnackbar(e.t0.message,{variant:"error"});case 26:S(!1),null===(t=h.current)||void 0===t||t.focus();case 28:case"end":return e.stop()}}),e,null,[[9,23]])}))),[g,o,i,l,s,r,u,a.uid]),N=function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,w();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),"Enter"!==t.key){e.next=4;break}return e.next=4,w();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)("div",{className:j.search,children:Object(U.jsx)(xe.a,{inputRef:h,disabled:C,placeholder:"message",classes:{root:j.inputRoot,input:j.inputInput},value:g,onChange:function(e){v(e.target.value)},onKeyUp:E,inputProps:{"aria-label":"search",maxLength:255}})}),Object(U.jsxs)(I.a,{variant:"caption",className:j.messageLength,children:[null!==(t=null===(n=h.current)||void 0===n?void 0:n.value.length)&&void 0!==t?t:0,"/255"]}),Object(U.jsx)(T.a,{variant:"contained",onClick:N,disabled:!g.trim()||C,children:Object(U.jsx)(ge.a,{})})]})})),Se=n(32),we=n(594),Ne=n(558),Ie=n(563),Ee=n(281),Te=n(559),Ae=n(560),Re=n(507),Pe=n(561),Ue=n(562),De=n(6),Le=n(557),Me=n(601),Fe=n(603),Ke=Object(De.a)((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(Le.a),Be=Object(De.a)((function(e){return{badge:{backgroundColor:"grey",color:"grey",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",border:"1px solid currentColor",content:'""'}}}}))(Le.a),_e={overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},Ye="/logo192.png",We=Object(O.memo)((function(e){var t=e.user,n=In(),a=Object(O.useMemo)((function(){return"string"===typeof t?n.find((function(e){return e.uid===t})):t}),[t,n]);return Object(O.useMemo)((function(){if(!a)return Object(U.jsx)(Be,Object(j.a)(Object(j.a)({},_e),{},{children:Object(U.jsx)(Me.a,{"aria-label":"user-photo",src:Ye})}));var e=a.photoURL,t=a.lastActivity,n=e||Ye,r=n&&Object(U.jsx)(Me.a,{"aria-label":"user-photo",src:n});return Object(Fe.a)(Date.now(),t)<300?Object(U.jsx)(Ke,Object(j.a)(Object(j.a)({},_e),{},{children:r})):Object(U.jsx)(Be,Object(j.a)(Object(j.a)({},_e),{},{children:r}))}),[a])})),He=n(4),Ge=n(592),qe={textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},ze=Object(C.a)((function(e){return{listItem:{padding:e.spacing(0,2),textTransform:"none"},listItemSelected:{backgroundColor:e.palette.background.paper,borderRadius:e.shape.borderRadius},tabContainer:{display:"flex",alignItems:"center",marginBottom:e.spacing(1)},tabContainerMobile:{width:"calc(100% - 44px)"},primaryTypographyStyle:Object(j.a)(Object(j.a)({},qe),{},{marginRight:e.spacing(1)}),tabRootMessage:{minWidth:"100%",padding:e.spacing(0,1)},timeDisplay:{display:"flex",alignItems:"center"},timeIcon:{fontSize:".75em",marginRight:e.spacing(1)}}})),Ve=Object(O.memo)((function(e){var t,n=e.setSelectedUserID,a=e.selected,r=void 0!==a&&a,c=e.user,s=Object(R.a)(e,["setSelectedUserID","selected","user"]),o=Object(Q.a)(),i=Object(Z.a)(o.breakpoints.down("sm"));Object(O.useEffect)((function(){r&&n(c.uid)}),[i,r,n,c.uid]);var l=Sn().userIsAuthenticated,u=ze(),d=c.lastActivity,b=Object(O.useMemo)((function(){var e=Date.now();return Object(Ge.a)(d,e)}),[d]),h=Object(O.useState)(),m=Object(p.a)(h,2),f=m[0],x=m[1],g=Boolean(f),v=function(){x(void 0)},y=Object(O.useState)(!1),k=Object(p.a)(y,2),C=k[0],S=k[1],w=Object(O.useCallback)((function(){S(!0),v()}),[]),N=Object(O.useCallback)((function(){S(!1),v()}),[]);return Object(U.jsxs)("div",{className:Object(He.a)(u.tabContainer,Object(me.a)({},u.tabContainerMobile,i)),children:[i&&Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(E.a,{onClick:function(e){x(e.currentTarget)},children:Object(U.jsx)(Ne.a,{fontSize:"small",color:"primary"})}),Object(U.jsx)(Ee.a,{anchorEl:f,keepMounted:!0,open:g,onClose:v,children:Object(U.jsx)(Te.a,{onClick:w,children:"Delete Messages"})})]}),Object(U.jsx)(Ae.a,Object(j.a)(Object(j.a)({},s),{},{id:"message-tab-".concat(c.uid),disabled:!l,classes:{root:u.tabRootMessage},icon:Object(U.jsxs)(Re.a,{button:!0,className:Object(He.a)(u.listItem,Object(me.a)({},u.listItemSelected,r)),alignItems:"flex-start",children:[Object(U.jsx)(Pe.a,{children:Object(U.jsx)(We,{user:c})}),Object(U.jsx)(Ue.a,{primary:Object(U.jsx)(I.a,{className:u.primaryTypographyStyle,children:null!==(t=c.displayName)&&void 0!==t?t:c.uid}),secondary:Object(U.jsxs)(I.a,{className:u.timeDisplay,variant:"caption",color:"textSecondary",children:[Object(U.jsx)(Ie.a,{className:u.timeIcon})," ",b]}),secondaryTypographyProps:{style:qe}})]})})),Object(U.jsx)(X,{type:"recipient",recipientID:c.uid,open:C,onClose:N,onConfirm:N})]})})),Je=Object(C.a)((function(e){return{container:{display:"flex",flexDirection:"column",overflow:"hidden",overflowY:"auto"},tabsRootMessage:{flexGrow:1,backgroundColor:"none",height:"100%",width:"100%"},tabsFlexContainerVertical:{height:"100%"}}})),Xe=Object(O.memo)((function(e){var t=e.setSelectedUserID,n=e.onChatItemClicked,a=e.newConversationIDs,r=void 0===a?[]:a,c=Je(),s=Nn(),o=In(),i=gn(),l=Object(O.useMemo)((function(){return s?i.collection("messages").orderBy("created").where("sender","==",s.uid):i.collection("noop")}),[i,s]),u=x(l).docs,d=Object(O.useMemo)((function(){return s?i.collection("messages").orderBy("created").where("recipient","==",s.uid):i.collection("noop")}),[i,s]),j=x(d).docs,b=Object(O.useMemo)((function(){if(!s)return[];var e=u.map((function(e){return{id:e.recipient,created:e.created}})),t=j.map((function(e){return{id:e.sender,created:e.created}})),n=[].concat(Object(Se.a)(e),Object(Se.a)(t)).filter((function(e){return e.created})).sort((function(e,t){return t.created.seconds-e.created.seconds})).map((function(e){return e.id})).filter(Boolean);return Array.from(new Set([].concat(Object(Se.a)(r),Object(Se.a)(n))))}),[s,u,j,r]),h=Object(O.useMemo)((function(){return o.filter((function(e){return b.includes(e.uid)}))}),[b,o]);Object(O.useEffect)((function(){0===h.length&&t("")}),[h,t]);var m=Object(O.useState)(0),f=Object(p.a)(m,2),g=f[0],v=f[1],y=Object(O.useCallback)((function(e,t){n&&n(t),v(t)}),[n]),k=Object(O.useMemo)((function(){return h.map((function(e,n){return Object(U.jsx)(Ve,{selected:n===g,setSelectedUserID:t,user:e},n)}))}),[g,h,t]);return Object(U.jsx)(S.a,{className:c.container,children:Object(U.jsxs)(we.a,{value:g,onChange:y,classes:{root:c.tabsRootMessage,flexContainer:c.tabsFlexContainerVertical},variant:"scrollable",scrollButtons:"auto",orientation:"vertical",children:[Object(U.jsx)("div",{}),k]})})})),$e=n(564),Qe=Object(C.a)((function(e){return{container:{padding:e.spacing(1,2)},box:{display:"flex"},grow:{flexGrow:1},paper:{height:"calc(100% - 5em)"}}})),Ze=Object(O.memo)((function(e){var t=e.value,n=e.index,a=e.setSelectedUserID,r=e.onChatItemClicked,c=Qe(),s=Object(O.useState)([]),o=Object(p.a)(s,2),i=o[0],l=o[1],u=Object(O.useState)(),d=Object(p.a)(u,2),j=d[0],b=d[1],h=Boolean(j),m=function(){b(void 0)},f=Object(O.useState)(!1),x=Object(p.a)(f,2),g=x[0],v=x[1],y=Object(O.useCallback)((function(){v(!0),m()}),[]),k=Object(O.useCallback)((function(){v(!1),m()}),[]),C=Object(O.useState)(!1),w=Object(p.a)(C,2),T=w[0],A=w[1],R=Object(O.useCallback)((function(){A(!0)}),[]),P=Object(O.useCallback)((function(e){l((function(t){return Array.from(new Set([].concat(Object(Se.a)(t),[e])))})),A(!1)}),[]),D=Object(O.useCallback)((function(){A(!1)}),[]),L=Object(O.useCallback)((function(){l([]),m()}),[]);return Object(U.jsxs)(Tt,{value:t,index:n,children:[Object(U.jsx)(S.a,{className:c.container,children:Object(U.jsxs)(N.a,{mb:1,className:c.box,children:[Object(U.jsx)(I.a,{variant:"h5",children:"Chats"}),Object(U.jsx)("div",{className:c.grow}),Object(U.jsx)(E.a,{onClick:R,children:Object(U.jsx)($e.a,{fontSize:"small",color:"primary"})}),Object(U.jsx)(E.a,{onClick:function(e){b(e.currentTarget)},children:Object(U.jsx)(Ne.a,{fontSize:"small",color:"primary"})}),Object(U.jsxs)(Ee.a,{anchorEl:j,keepMounted:!0,open:h,onClose:m,children:[Object(U.jsx)(Te.a,{onClick:L,children:"Remove Empty (New)"}),Object(U.jsx)(Te.a,{onClick:y,children:"Delete Messages"})]})]})}),Object(U.jsx)(Xe,{setSelectedUserID:a,onChatItemClicked:r,newConversationIDs:i}),Object(U.jsx)(X,{type:"nuclear",open:g,onClose:k,onConfirm:k}),Object(U.jsx)($,{open:T,onClose:D,onConfirm:P})]})})),et=(n(597),n(565),n(566),Object(C.a)((function(e){return{formHelperText:{display:"flex",alignItems:"center"}}})),n(595),Object(C.a)((function(e){return{formHelperText:{display:"flex",alignItems:"center"}}})),n(567)),tt=Object(C.a)((function(e){return{container:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",flexDirection:"column"},paper:{padding:e.spacing(2)},paragraph:{textAlign:"center",marginBottom:e.spacing(1)}}})),nt=function(){var e=tt();return Object(U.jsxs)(S.a,{className:e.container,children:[Object(U.jsx)("img",{src:"logo.png",alt:"logo",style:{maxWidth:"50%"}}),Object(U.jsx)(I.a,{children:"Secure Encrypted Messaging"}),Object(U.jsx)(I.a,{children:"No logs. No activity. No Meta. No servers."}),Object(U.jsx)(N.a,{margin:1,children:Object(U.jsxs)(I.a,{className:e.paragraph,children:["In using this application you agree to the"," ",Object(U.jsx)(et.a,{href:"/#/terms",target:"_blank",rel:"noopener noreferrer",children:"terms"})," ","and"," ",Object(U.jsx)(et.a,{href:"/#/privacy",target:"_blank",rel:"noopener noreferrer",children:"privacy"})," ","policies set forth."]})}),Object(U.jsx)("a",{href:"https://play.google.com/store/apps/details?id=app.unlynk.kodeniks&pcampaignid=pcampaignidMKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1",children:Object(U.jsx)("img",{width:"240px",alt:"Get it on Google Play",src:"https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png"})})]})},at=n(568),rt=n(569),ct=n(570),st=n(571),ot=n(572),it=Object(C.a)((function(e){return{actionButton:{padding:e.spacing(0)},missingOppositeContent:{"&:before":{display:"none"}},oppositeContentRoot:{flex:"none",minWidth:"10%",width:"auto",maxWidth:"80%",padding:e.spacing(.5,1)},messageComponent:{display:"flex"},messageComponentStart:{justifyContent:"flex-start"},messageComponentEnd:{justifyContent:"flex-end"},messageNameStart:{marginLeft:"20px"},messageNameEnd:{marginRight:"20px"},paper:{padding:e.spacing(1,2),textAlign:"left"},paperPrimary:{backgroundColor:e.palette.primary.dark,color:e.palette.primary.contrastText},paperSecondary:{backgroundColor:e.palette.secondary.dark,color:e.palette.secondary.contrastText},timeDisplay:{display:"flex",alignItems:"center",color:e.palette.grey[400]},timeIcon:{fontSize:".75em",marginRight:e.spacing(1),color:e.palette.grey[400]},timelineDot:{backgroundColor:e.palette.background.default},grow:{flexGrow:1}}})),lt=Object(O.memo)((function(e){var t,n,a,r=e.message,c=r.id,s=r.created,o=r.value,i=r.sender,l=null===(t=In().find((function(e){return e.id===i})))||void 0===t?void 0:t.displayName,u=Object(Q.a)(),d=Object(Z.a)(u.breakpoints.down("sm")),j=Nn(),b=it(),h=Object(O.useMemo)((function(){var e=Date.now(),t=(null===s||void 0===s?void 0:s.seconds)?new Date(1e3*(null===s||void 0===s?void 0:s.seconds)):e;return Object(Ge.a)(t,e)}),[s]),m=Object(O.useState)(),f=Object(p.a)(m,2),x=f[0],g=f[1],v=Boolean(x),y=function(){g(void 0)},k=Object(O.useState)(!1),C=Object(p.a)(k,2),S=C[0],T=C[1],A=Object(O.useCallback)((function(){T(!0),y()}),[]),R=Object(O.useCallback)((function(){T(!1),y()}),[]),P=j&&i===j.uid,D=Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)("div",{className:Object(He.a)(b.messageComponent,(n={},Object(me.a)(n,b.messageComponentEnd,P),Object(me.a)(n,b.messageComponentStart,!P),n)),children:[!P&&Object(U.jsx)(N.a,{}),Object(U.jsxs)(w.a,{className:Object(He.a)(b.paper,(a={},Object(me.a)(a,b.paperPrimary,P),Object(me.a)(a,b.paperSecondary,!P),a)),children:[Object(U.jsx)(I.a,{children:o}),Object(U.jsxs)(I.a,{className:b.timeDisplay,variant:"caption",color:"textSecondary",children:[Object(U.jsx)(Ie.a,{className:b.timeIcon})," ",h]})]}),P&&Object(U.jsxs)(N.a,{children:[Object(U.jsx)(E.a,{className:b.actionButton,onClick:function(e){g(e.currentTarget)},children:Object(U.jsx)(Ne.a,{fontSize:"small",color:"primary"})}),Object(U.jsx)(Ee.a,{anchorEl:x,keepMounted:!0,open:v,onClose:y,children:Object(U.jsx)(Te.a,{onClick:A,children:"Delete"})})]})]}),Object(U.jsx)(I.a,{variant:"caption",className:Object(He.a)("",Object(me.a)({},b.messageNameEnd,P)),children:Object(U.jsx)("strong",{children:null!==l&&void 0!==l?l:i})})]});return Object(U.jsxs)(at.a,{classes:{missingOppositeContent:b.missingOppositeContent},children:[P&&!d&&Object(U.jsx)("div",{className:b.grow}),P&&Object(U.jsx)(rt.a,{classes:{root:Object(He.a)("",Object(me.a)({},b.oppositeContentRoot,!d))},children:D}),Object(U.jsx)(ct.a,{children:Object(U.jsx)(st.a,{className:b.timelineDot,variant:"outlined",color:P?"primary":"secondary",children:Object(U.jsx)(We,{user:i})})}),!P&&Object(U.jsx)(ot.a,{classes:{root:d?"":b.oppositeContentRoot},children:D}),!P&&!d&&Object(U.jsx)("div",{className:b.grow}),Object(U.jsx)(X,{type:"single",messageID:c,open:S,onClose:R,onConfirm:R})]})})),ut=n(83),dt=Object(C.a)((function(e){return{box:{padding:e.spacing(0,2),overflow:"hidden",overflowY:"auto",flexGrow:1},messageValue:{color:"transparent",textShadow:"0 0 8px rgba(0,0,0,0.5)"}}})),jt=Object(O.memo)((function(e){var t=e.selectedUserID,n=dt(),a=Object(V.b)(),r=Mn(),c=r.puk,s=r.privateKey,o=r.publicKeys,i=Nn(),l=gn(),u=Object(O.useState)([]),h=Object(p.a)(u,2),m=h[0],f=h[1],g=Object(O.useMemo)((function(){return i?l.collection("messages").orderBy("created").where("sender","==",i.uid).where("recipient","==",t).limit(100):l.collection("noop")}),[l,t,i]),v=Object(O.useMemo)((function(){return i?l.collection("messages").orderBy("created").where("sender","==",t).where("recipient","==",i.uid).limit(100):l.collection("noop")}),[l,t,i]),y=x(g).docs,k=x(v).docs,C=Object(O.useMemo)((function(){var e=[].concat(Object(Se.a)(y),Object(Se.a)(k)).filter((function(e){return e.created})).sort((function(e,t){return e.created.seconds-t.created.seconds}));return Object(ve.getUniqueByProp)(e,"id")}),[k,y]),S=Object(O.useRef)(null);Object(O.useLayoutEffect)((function(){(function(){var e=Object(b.a)(d.a.mark((function e(){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c&&s&&t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Object(ve.computeSharedKeyString)(c,s.value,t,o);case 5:(r=e.sent)||a.enqueueSnackbar("Decryption Failed. Is your PUK correct?",{variant:"error"}),i=C.map((function(e){return Object(j.a)(Object(j.a)({},e),{},{value:r?Object(ve.decrypt)(r,e.value):Object(U.jsx)("span",{className:n.messageValue,children:e.value})})})).filter((function(e){return e.value})),f(i),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(2);case 13:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}})()()}),[C,s,o,c,a,t,n.messageValue]),Object(O.useEffect)((function(){S.current&&S.current.scrollIntoView()}),[m]);var w=Object(O.useMemo)((function(){return m.map((function(e){return Object(U.jsx)(lt,{message:e},e.id)}))}),[m]);return Object(U.jsx)(N.a,{className:n.box,children:c?Object(U.jsxs)(U.Fragment,{children:[w,Object(U.jsx)("div",{ref:S})]}):Object(U.jsx)(N.a,{marginTop:2,children:Object(U.jsxs)(be,{severity:"error",title:"Security Issue",children:["You can't see or do anything until you enter your PUK. Please visit the ",Object(U.jsx)(ut.b,{to:"/",children:"dashboard"}),"."]})})})})),bt=n(573),pt=n(574),Ot=n(575),ht=Object(C.a)((function(e){return{column:{display:"flex",flexDirection:"column",height:"100%"},name:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"18em"},noChatSelected:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",flexDirection:"column"},box:{display:"flex",alignItems:"center"},grow:{flexGrow:1},toolbar:{padding:e.spacing(0,1)},loginMessage:{flexGrow:1,textAlign:"center"},divider:{marginBottom:e.spacing(1)}}})),mt=Object(O.memo)((function(e){var t=e.backAction,n=e.selectedUserID,a=ht(),r=Sn(),c=r.users,s=r.userAuth,o=Object(O.useMemo)((function(){return c.find((function(e){return e.uid===n}))}),[n,c]),i=Object(O.useState)(),l=Object(p.a)(i,2),u=l[0],d=l[1],j=Object(Q.a)(),b=Object(Z.a)(j.breakpoints.down("sm")),h=Boolean(u),m=function(e){d(e.currentTarget)},f=function(){d(void 0)},x=Object(O.useState)(!1),g=Object(p.a)(x,2),v=g[0],y=g[1],k=Object(O.useCallback)((function(){y(!0),f()}),[]),C=Object(O.useCallback)((function(){y(!1),f()}),[]),S=Object(O.useCallback)((function(){y(!1),f()}),[]),w=Object(O.useMemo)((function(){return n?Object(U.jsxs)("div",{className:a.column,children:[Object(U.jsxs)(N.a,{p:1,className:a.box,children:[b&&t,Object(U.jsx)(N.a,{mr:1,children:Object(U.jsx)(We,{user:n})}),Object(U.jsx)(I.a,{variant:"h6",className:a.name,children:(null===o||void 0===o?void 0:o.displayName)||(null===o||void 0===o?void 0:o.uid)}),!b&&Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)("div",{className:a.grow}),Object(U.jsx)(E.a,{onClick:m,children:Object(U.jsx)(Ne.a,{fontSize:"small",color:"primary"})}),Object(U.jsx)(Ee.a,{anchorEl:u,keepMounted:!0,open:h,onClose:f,children:Object(U.jsx)(Te.a,{onClick:k,children:"Delete Messages"})})]})]}),Object(U.jsx)(bt.a,{className:a.divider}),Object(U.jsx)(jt,{selectedUserID:n}),Object(U.jsx)(bt.a,{}),s?Object(U.jsx)(pt.a,{disableGutters:!0,variant:"dense",className:a.toolbar,children:Object(U.jsx)(Ce,{user:s,selectedUserID:n})}):Object(U.jsx)("div",{className:a.loginMessage,children:Object(U.jsx)(I.a,{variant:"body1",children:"You must be logged in to send messages."})}),Object(U.jsx)(X,{type:"recipient",recipientID:n,open:v,onClose:C,onConfirm:S})]}):Object(U.jsxs)("div",{className:a.noChatSelected,children:[Object(U.jsx)(Ot.a,{style:{fontSize:"10em"}}),Object(U.jsx)(I.a,{children:"Select a conversation or why not start one?"})]})}),[u,t,a.box,a.column,a.divider,a.grow,a.loginMessage,a.name,a.noChatSelected,a.toolbar,C,S,k,b,h,n,v,null===o||void 0===o?void 0:o.displayName,null===o||void 0===o?void 0:o.uid,s]);return Object(U.jsx)(U.Fragment,{children:w})})),ft=k.a({accountID:k.b().min(1,'Account ID should be at least 1 character to "try"').trim().required()}),xt=Object(C.a)((function(e){return{form:{width:"100%"},box:{display:"flex",flexDirection:"column",alignItems:"center"},formContent:{paddingBottom:e.spacing(1)}}})),gt={required:!0,fullWidth:!0},vt="accountIDForm",yt=Object(O.memo)((function(e){var t=e.onConfirm,n=xt(),a=Object(O.useState)({accountID:""}),r=Object(p.a)(a,1)[0],c=Object(O.useCallback)((function(e,n){var a=e.accountID;n.setSubmitting;t(a)}),[t]);return Object(U.jsx)(S.a,{maxWidth:"sm",children:Object(U.jsxs)(N.a,{className:n.box,children:[Object(U.jsx)(N.a,{marginTop:1,marginBottom:2,children:Object(U.jsx)(I.a,{children:"Please enter an Account ID to begin a conversation."})}),Object(U.jsx)(D,{className:n.form,id:vt,initialValues:r,onSubmit:c,validationSchema:ft,children:Object(U.jsxs)(N.a,{className:n.formContent,children:[Object(U.jsx)(Y,{id:"accountID",name:"accountID",label:"account identifier",FormControlProps:gt}),Object(U.jsx)(T.a,{form:vt,color:"primary",variant:"contained",fullWidth:!0,type:"submit",children:"Begin"})]})})]})})})),kt=n(576),Ct=n(577),St=Object(C.a)((function(e){return{suggestion:{paddingLeft:"1em",display:"flex",alignItems:"center"}}})),wt=Object(O.memo)((function(e){var t,n=e.password,a=St(),r=Object(O.useState)({password:n,score:0,feedback:{warning:"",suggestions:[]},crack_times_display:{offline_fast_hashing_1e10_per_second:"",offline_slow_hashing_1e4_per_second:"",online_no_throttling_10_per_second:"",online_throttling_100_per_hour:""}}),c=Object(p.a)(r,2),s=c[0],o=c[1];return Object(O.useEffect)((function(){var e=window.zxcvbn(n),t=e.score,a=e.feedback,r=e.crack_times_display;o((function(e){return Object(j.a)(Object(j.a)({},e),{},{password:n,score:t,feedback:a,crack_times_display:r})}))}),[n]),Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)(N.a,{margin:0,marginBottom:2,children:[Object(U.jsx)(I.a,{children:"Password Strength:"}),Object(U.jsx)(kt.a,{variant:"determinate",value:(t=s.score,100*(t-0)/4)})]}),s.password.length>0&&Object(U.jsxs)(N.a,{margin:0,marginBottom:2,children:[Object(U.jsx)(I.a,{variant:"h6",children:"Feedback:"}),s.feedback.warning&&Object(U.jsx)(be,{color:"error",children:s.feedback.warning}),s.crack_times_display.offline_fast_hashing_1e10_per_second&&Object(U.jsxs)(be,{color:"warning",children:["Crack Time: ",s.crack_times_display.offline_fast_hashing_1e10_per_second]}),s.feedback.suggestions.length>0&&Object(U.jsx)(N.a,{margin:0,marginBottom:2,children:s.feedback.suggestions.map((function(e,t){return Object(U.jsxs)(I.a,{className:a.suggestion,variant:"body2",children:[Object(U.jsx)(Ct.a,{fontSize:"small"})," ",e]},t)}))})]})]})})),Nt=Object(C.a)((function(e){return{paragraph:{marginBottom:e.spacing(1)},accordionDetails:{flexDirection:"column"},paper:{padding:e.spacing(2)}}})),It=function(e){var t=e.isDialog,n=Nt(),a=Object(Q.a)(),r=Object(Z.a)(a.breakpoints.down("sm"));return Object(U.jsx)(S.a,{style:Object(j.a)({},r?{padding:0}:void 0),children:Object(U.jsxs)(le,{className:n.paper,elevation:1,children:[!t&&Object(U.jsx)(I.a,{variant:"h4",children:"Privacy Policy"}),Object(U.jsx)(I.a,{className:n.paragraph,children:"Unlynk utilizes state-of-the-art security and end-to-end encryption to provide private messaging to users worldwide (\u201cServices\u201d). Your messages are always encrypted, so they can never be shared or viewed by anyone but yourself and the intended recipients."}),Object(U.jsx)(I.a,{variant:"h6",children:"Information you provide"}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Account Information."})," You can choose to register with an email address when you create a Unlynk account or you can remain anonymous. You may optionally add other information to your account, such as a profile name and profile picture."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Messages."})," Unlynk cannot decrypt or otherwise access the content of your messages or calls. Unlynk saves end-to-end encrypted messages in its database. Each messages is signed with an unshared key; that is generated using ECDH key exchanges with the intended recipient. Additionally the messages are encrypted from a private key that is hashed with a Personal Unlock Key (AES256 cipher, with sha256). Loss of this key means a loss of all ability to read and send messages."]}),Object(U.jsx)(I.a,{className:n.paragraph,children:"Additional technical information is stored by Firebase, including randomly generated authentication tokens, keys, push tokens, and other material that is necessary to establish to keep your device authenticated. Unlynk limits this additional technical information to the minimum required to operate the Services."}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Contacts."})," Unlynk has no access to any contacts."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"User Support."})," If you contact Unlynk User Support, any personal data you may share with us is kept only for the purposes of researching the issue and contacting you about your case."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Managing your information."})," You can manage your personal information in Unlynk\u2019s application Settings. For example, you can update your profile information or delete your account. When deleting your account (or logging out of an anoynous account) it will delete all information. This includes ANY message sent or received by you regardless of who's involved."]}),Object(U.jsx)(I.a,{variant:"h6",children:"Information we may share"}),Object(U.jsx)(I.a,{className:n.paragraph,children:'We by default do not share any data, except in the "other" instances.'}),Object(U.jsx)(I.a,{className:n.paragraph,children:Object(U.jsx)("strong",{children:"Other instances where Unlynk may need to share your data"})}),Object(U.jsx)(I.a,{className:n.paragraph,children:Object(U.jsxs)("ul",{children:[Object(U.jsx)("li",{children:"To meet any applicable law, regulation, legal process or enforceable governmental request."}),Object(U.jsx)("li",{children:"To enforce applicable Terms, including investigation of potential violations."}),Object(U.jsx)("li",{children:"To detect, prevent, or otherwise address fraud, security, or technical issues."}),Object(U.jsx)("li",{children:"To protect against harm to the rights, property, or safety of Unlynk, our users, or the public as required or permitted by law."})]})}),Object(U.jsx)(I.a,{variant:"h6",children:"Updates"}),Object(U.jsx)(I.a,{className:n.paragraph,children:"We will update this privacy policy as needed so that it is current, accurate, and as clear as possible. Your continued use of our Services confirms your acceptance of our updated Privacy Policy."}),Object(U.jsx)(I.a,{variant:"h6",children:"Contact Us"}),Object(U.jsx)(I.a,{className:n.paragraph,children:"If you have questions about please contact us at freeze@kodeniks.com"}),Object(U.jsx)(I.a,{children:"Updated: March 13th, 2021, 3:22PM PST"}),Object(U.jsx)(I.a,{children:"Effective: March 13th, 2021, 3:22PM PST"})]})})},Et=Object(C.a)((function(e){return{panel:{height:"100%",backgroundColor:e.palette.background.default},panelMobile:{height:"calc(100% - 4em)"}}})),Tt=Object(O.memo)((function(e){var t=e.children,n=e.value,a=e.index,r=Et(),c=Object(Q.a)(),s=Object(Z.a)(c.breakpoints.down("sm"));return Object(U.jsx)("div",{role:"tabpanel",className:Object(He.a)(r.panel,Object(me.a)({},r.panelMobile,s)),hidden:n!==a,id:"tabpanel-".concat(a),children:Object(U.jsx)(N.a,{style:{height:"100%"},children:t})})})),At=Object(C.a)((function(e){return{paragraph:{marginBottom:e.spacing(1)},accordionDetails:{flexDirection:"column"},paper:{padding:e.spacing(2)}}})),Rt=function(e){var t=e.isDialog,n=At(),a=Object(Q.a)(),r=Object(Z.a)(a.breakpoints.down("sm"));return Object(U.jsx)(S.a,{style:Object(j.a)({},r?{padding:0}:void 0),children:Object(U.jsxs)(le,{className:n.paper,elevation:1,children:[!t&&Object(U.jsx)(I.a,{variant:"h4",children:"Terms of Service"}),Object(U.jsx)(I.a,{className:n.paragraph,children:"Unlynk utilizes end-to-end encryption to provide private messaging to users worldwide. You agree to our Terms of Service (\u201cTerms\u201d) by installing or using our apps, services, or website (together, \u201cServices\u201d)."}),Object(U.jsx)(I.a,{variant:"h6",children:"About our services"}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Minimum Age."})," You must be at least 13 years old to use our Services. The minimum age to use our Services without parental approval may be higher in your home country."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Account Registration."})," You can create an account with an email, or remain anonymous."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Privacy of user data."})," Unlynk does not sell, rent or monetize your personal data or content in any way."]}),Object(U.jsx)(I.a,{className:n.paragraph,children:"Please read our Privacy Policy to understand how we safeguard the information you provide when using our Services. For the purpose of operating our Services, you agree to our data practices as described in our Privacy Policy, as well as the transfer of your encrypted information and metadata to the United States and other countries where we have or use facilities, service providers or partners."}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Software."})," In order to enable new features and enhanced functionality, you consent to downloading and installing updates to our Services."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Fees and Taxes."})," You are responsible for data and mobile carrier fees and taxes associated with the devices on which you use our Services."]}),Object(U.jsx)(I.a,{variant:"h6",children:"Using Unlynk"}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Our Terms and Policies."})," You must use our Services according to our Terms and posted policies. If we disable your account for a violation of our Terms, you will not create another account without our permission."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Legal and Acceptable Use."})," You agree to use our Services only for legal, authorized, and acceptable purposes. You will not use (or assist others in using) our Services in ways that: (a) violate or infringe the rights of Unlynk, our users, or others, including privacy, publicity, intellectual property, or other proprietary rights; (b) involve sending illegal or impermissible communications such as bulk messaging, auto-messaging, and auto-dialing."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Harm to Unlynk."})," You must not (or assist others to) access, use, modify, distribute, transfer, or exploit our Services in unauthorized manners, or in ways that harm Unlynk, our Services, or systems. For example you must not (a) gain or try to gain unauthorized access to our Services or systems; (b) disrupt the integrity or performance of our Services; (c) create accounts for our Services through unauthorized or automated means; (d) collect information about our users in any unauthorized manner; or (e) sell, rent, or charge for our Services."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Keeping Your Account Secure."})," Unlynk embraces privacy by design and does not have the ability to access your messages. You are responsible for keeping your device and your Unlynk account safe and secure. If you lose your device or forget your Personal Unlock Key you must re-register for our Services. In the event you made an account with an email address you can reset your password."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"No Access to Emergency Services."})," Our Services do not provide access to emergency service providers like the police, fire department, hospitals, or other public safety organizations. Make sure you can contact emergency service providers through a mobile, fixed-line telephone, or other service."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Third-party services."})," Our Services may allow you to access, use, or interact with third-party websites, apps, content, and other products and services. When you use third-party services, their terms and privacy policies govern your use of those services."]}),Object(U.jsx)(I.a,{variant:"h6",children:"Your Rights and License with Unlynk"}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Your Rights."})," You own the information you submit through our Services. You must have the rights to the email address you use to sign up for your Unlynk account."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Unlynk\u2019s Rights."})," We own all copyrights, trademarks, domains, logos, trade dress, trade secrets, patents, and other intellectual property rights associated with our Services. You may not use our copyrights, trademarks, domains, logos, trade dress, patents, and other intellectual property rights unless you have our written permission. To report copyright, trademark, or other intellectual property infringement, please contact feeze@kodeniks.com."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Unlynk\u2019s License to You."})," Unlynk grants you a limited, revocable, non-exclusive, and non-transferable license to use our Services in accordance with these Terms."]}),Object(U.jsx)(I.a,{variant:"h6",children:"Disclaimers and Limitations"}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Disclaimers."})," YOU USE OUR SERVICES AT YOUR OWN RISK AND SUBJECT TO THE FOLLOWING DISCLAIMERS. WE PROVIDE OUR SERVICES ON AN \u201cAS IS\u201d BASIS WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE, NON-INFRINGEMENT, AND FREEDOM FROM COMPUTER VIRUS OR OTHER HARMFUL CODE. Unlynk DOES NOT WARRANT THAT ANY INFORMATION PROVIDED BY US IS ACCURATE, COMPLETE, OR USEFUL, THAT OUR SERVICES WILL BE OPERATIONAL, ERROR-FREE, SECURE, OR SAFE, OR THAT OUR SERVICES WILL FUNCTION WITHOUT DISRUPTIONS, DELAYS, OR IMPERFECTIONS. WE DO NOT CONTROL, AND ARE NOT RESPONSIBLE FOR, CONTROLLING HOW OR WHEN OUR USERS USE OUR SERVICES. WE ARE NOT RESPONSIBLE FOR THE ACTIONS OR INFORMATION (INCLUDING CONTENT) OF OUR USERS OR OTHER THIRD PARTIES. YOU RELEASE US, AFFILIATES, DIRECTORS, OFFICERS, EMPLOYEES, PARTNERS, AND AGENTS (TOGETHER, \u201cUnlynk PARTIES\u201d) FROM ANY CLAIM, COMPLAINT, CAUSE OF ACTION, CONTROVERSY, OR DISPUTE (TOGETHER, \u201cCLAIM\u201d) AND DAMAGES, KNOWN AND UNKNOWN, RELATING TO, ARISING OUT OF, OR IN ANY WAY CONNECTED WITH ANY SUCH CLAIM YOU HAVE AGAINST ANY THIRD PARTIES."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Limitation of liability."})," THE Unlynk PARTIES WILL NOT BE LIABLE TO YOU FOR ANY LOST PROFITS OR CONSEQUENTIAL, SPECIAL, PUNITIVE, INDIRECT, OR INCIDENTAL DAMAGES RELATING TO, ARISING OUT OF, OR IN ANY WAY IN CONNECTION WITH OUR TERMS, US, OR OUR SERVICES, EVEN IF THE Unlynk PARTIES HAVE BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. OUR AGGREGATE LIABILITY RELATING TO, ARISING OUT OF, OR IN ANY WAY IN CONNECTION WITH OUR TERMS, US, OR OUR SERVICES WILL NOT EXCEED ONE HUNDRED DOLLARS ($100). THE FOREGOING DISCLAIMER OF CERTAIN DAMAGES AND LIMITATION OF LIABILITY WILL APPLY TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW. THE LAWS OF SOME STATES OR JURISDICTIONS MAY NOT ALLOW THE EXCLUSION OR LIMITATION OF CERTAIN DAMAGES, SO SOME OR ALL OF THE EXCLUSIONS AND LIMITATIONS SET FORTH ABOVE MAY NOT APPLY TO YOU. NOTWITHSTANDING ANYTHING TO THE CONTRARY IN OUR TERMS, IN SUCH CASES, THE LIABILITY OF THE Unlynk PARTIES WILL BE LIMITED TO THE FULLEST EXTENT PERMITTED BY APPLICABLE LAW."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Availability of Our Services."})," Our Services may be interrupted, including for maintenance, upgrades, or network or equipment failures. We may discontinue some or all of our Services, including certain features and the support for certain devices and platforms, at any time."]}),Object(U.jsx)(I.a,{variant:"h6",children:"Resolving Disputes and Ending Terms"}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Resolving disputes."})," You agree to resolve any Claim you have with us relating to or arising out of our Terms, us, or our Services exclusively in Canada in the jurisdiction of Vancouver, BC. You also agree to submit to the personal jurisdiction of such courts for the purpose of litigating all such disputes. The laws of the province of British Columbia govern our Terms, as well as any disputes, whether in court or arbitration, which might arise between Unlynk and you, without regard to conflict of law provisions."]}),Object(U.jsxs)(I.a,{className:n.paragraph,children:[Object(U.jsx)("strong",{children:"Ending these Terms."})," You may end these Terms with Unlynk at any time by deleting Unlynk Messenger from your device and discontinuing use of our Services. We may modify, suspend, or terminate your access to or use of our Services anytime for any reason, such as if you violate the letter or spirit of our Terms or create harm, risk, or possible legal exposure for Unlynk. The following provisions will survive termination of your relationship with Unlynk: \u201cLicenses,\u201d \u201cDisclaimers,\u201d \u201cLimitation of Liability,\u201d \u201cResolving dispute,\u201d \u201cAvailability\u201d and \u201cEnding these Terms,\u201d and \u201cGeneral\u201d."]}),Object(U.jsx)(I.a,{variant:"h6",children:"General"}),Object(U.jsx)(I.a,{className:n.paragraph,children:"Unlynk may update the Terms from time to time. When we update our Terms, we will update the \u201cLast Modified\u201d date associated with the updated Terms. Your continued use of our Services confirms your acceptance of our updated Terms and supersedes any prior Terms. You will comply with all applicable export control and trade sanctions laws. Our Terms cover the entire agreement between you and Unlynk regarding our Services. If you do not agree with our Terms, you should stop using our Services."}),Object(U.jsx)(I.a,{className:n.paragraph,children:"If we fail to enforce any of our Terms, that does not mean we waive the right to enforce them. If any provision of the Terms is deemed unlawful, void, or unenforceable, that provision shall be deemed severable from our Terms and shall not affect the enforceability of the remaining provisions. Our Services are not intended for distribution to or use in any country where such distribution or use would violate local law or would subject us to any regulations in another country. We reserve the right to limit our Services in any country. If you have specific questions about these Terms, please contact us at privacy@Unlynk.org."}),Object(U.jsx)(I.a,{children:"Updated: March 13th, 2021, 3:22PM PST"}),Object(U.jsx)(I.a,{children:"Effective: March 13th, 2021, 3:22PM PST"})]})})},Pt=Object(C.a)((function(e){return{container:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},paper:{padding:e.spacing(2),display:"flex",flexDirection:"column",alignItems:"center"},form:{width:"100%"},button:{marginRight:e.spacing(1)},box:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},paragraph:{marginBottom:e.spacing(1)}}})),Ut={required:!0,fullWidth:!0},Dt=k.a({puk:k.b().min(8,"PUK must be at least 8 characters").trim().required("PUK is required to send, recieve messages, and generate a CrytopKeyPair")}),Lt="pukForm",Mt=function(){var e=Pt(),t=Object(V.b)(),n=Mn(),a=n.puk,r=n.privateKey,c=n.publicKeys,s=n.setPuk,o=Sn(),i=o.userAuth,l=o.userIsAuthenticated,u=Object(O.useState)({puk:l&&null!==a&&void 0!==a?a:""}),j=Object(p.a)(u,1)[0],h=Object(O.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.setSubmitting,e.next=3,Object(ve.computeSharedKeyString)(n.puk,null===r||void 0===r?void 0:r.value,null===i||void 0===i?void 0:i.uid,c);case 3:if(e.sent){e.next=7;break}return t.enqueueSnackbar("Encryption check failed. Is your PUK correct?",{variant:"error"}),e.abrupt("return");case 7:s(n.puk);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[s,null===r||void 0===r?void 0:r.value,null===i||void 0===i?void 0:i.uid,c,t]);return Object(U.jsx)("div",{className:e.container,children:Object(U.jsx)(S.a,{maxWidth:"xs",children:Object(U.jsxs)(w.a,{className:e.paper,children:[Object(U.jsxs)(I.a,{className:e.paragraph,children:["Your PUK is used to secure your ",Object(U.jsx)("strong",{children:"CryptoKeyPair"})," and unlock the ability to decrpt messages and send new ones."]}),Object(U.jsxs)(N.a,{marginBottom:2,children:[Object(U.jsxs)(I.a,{className:e.paragraph,children:["Please enter ",Object(U.jsx)("strong",{children:"P"}),"ersonal ",Object(U.jsx)("strong",{children:"U"}),"nlock ",Object(U.jsx)("strong",{children:"K"}),"ey (PUK)."]}),Object(U.jsx)(D,{className:e.form,id:Lt,initialValues:j,onSubmit:h,validationSchema:Dt,children:Object(U.jsx)(Y,{id:"puk",name:"puk",label:"Private Unlock Key",FormControlProps:Ut,InputProps:{type:"password"}})})]}),Object(U.jsx)(T.a,{type:"submit",form:Lt,variant:"contained",color:"primary",children:"Unlock"})]})})})},Ft=n(602),Kt=n(579),Bt=n(598),_t=n(578),Yt=Object(O.createContext)(void 0),Wt=function(e){var t=e.children,n=Object(V.b)(),a=Mn(),r=a.puk,c=a.privateKey,s=a.setPuk,o=Sn(),i=o.userAuth,l=o.userIsAuthenticated,u=xn(),j=f(l),h=Object(O.useState)(!c),x=Object(p.a)(h,2),g=x[0],v=x[1],k=Object(O.useState)(l?r?5:3:0),C=Object(p.a)(k,2),S=C[0],w=C[1],N=Object(O.useState)(i?i.isAnonymous?"anonymous":"account":void 0),I=Object(p.a)(N,2),E=I[0],T=I[1],A=Object(O.useState)("login"),R=Object(p.a)(A,2),P=R[0],D=R[1],L=Object(O.useState)(""),M=Object(p.a)(L,2),F=M[0],K=M[1],B=Object(O.useState)(""),_=Object(p.a)(B,2),Y=_[0],W=_[1],H=Object(O.useState)(null!==r&&void 0!==r?r:""),G=Object(p.a)(H,2),q=G[0],z=G[1],J=Object(O.useState)(!!(l&&r&&c)),X=Object(p.a)(J,2),$=X[0],Q=X[1],Z=y();Object(O.useEffect)((function(){j===l||l||(w(0),s(""),T(void 0),z(""),K(""),W(""),Q(!1))}),[j,s,l]),Object(O.useEffect)((function(){v(!c)}),[c]);var ee=Object(O.useMemo)((function(){return{complete:function(){var e=Object(b.a)(d.a.mark((function e(){var t,a,r,c,s,o,i,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ve.generateCryptoKeyPair)();case 3:return t=e.sent,e.next=6,Object(ve.convertCryptoKeyPairToHex)(t);case 6:if(a=e.sent,r=a.privateKey,c=a.publicKey,s=Object(ye.encrypt)(q,r),"anonymous"!==E){e.next=16;break}return e.next=13,u.auth().signInAnonymously();case 13:e.t0=e.sent,e.next=19;break;case 16:return e.next=18,u.auth().createUserWithEmailAndPassword(F,Y);case 18:e.t0=e.sent;case 19:if(o=e.t0,!g){e.next=23;break}return e.next=23,yn({privateKey:{created:m.a.firestore.FieldValue.serverTimestamp(),value:s,type:"private",owner:null===(i=o.user)||void 0===i?void 0:i.uid},publicKey:{created:m.a.firestore.FieldValue.serverTimestamp(),value:c,type:"public",owner:null===(l=o.user)||void 0===l?void 0:l.uid}});case 23:w((function(e){return e+1})),Q(!0),Z.setItem("setupComplete","true"),e.next=31;break;case 28:e.prev=28,e.t1=e.catch(0),n.enqueueSnackbar(e.t1.message,{variant:"error"});case 31:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(){return e.apply(this,arguments)}}()}}),[E,F,u,g,Y,n,Z,q]),te=Object(O.useState)({isNewUser:g,currentStep:S,setCurrentStep:w,accountType:E,setAccountType:T,accountMode:P,setAccountMode:D,email:F,setEmail:K,password:Y,setPassword:W,unlockKey:q,setUnlockKey:z,completed:$,setCompleted:Q,actions:ee}),ne=Object(p.a)(te,2),ae=ne[0],re=ne[1];return Object(O.useEffect)((function(){re({isNewUser:g,currentStep:S,setCurrentStep:w,accountType:E,setAccountType:T,accountMode:P,setAccountMode:D,email:F,setEmail:K,password:Y,setPassword:W,unlockKey:q,setUnlockKey:z,completed:$,setCompleted:Q,actions:ee})}),[P,E,ee,$,S,F,g,Y,q]),Object(U.jsx)(Yt.Provider,{value:ae,children:t})},Ht=function(){var e=Object(O.useContext)(Yt);if(!e)throw new Error("You must wrap your component in an OnboardingProvider");return e},Gt=Object(C.a)((function(e){return{button:{marginRight:e.spacing(1)},paragraph:{marginBottom:e.spacing(1)}}})),qt=Object(O.memo)((function(e){var t=Gt(),n=Ht(),a=n.setAccountType,r=n.setCurrentStep,c=Object(O.useCallback)((function(){a("anonymous"),r((function(e){return e+1}))}),[a,r]),s=Object(O.useCallback)((function(){a("account"),r((function(e){return e+1}))}),[a,r]);return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(Bt.a,Object(j.a)(Object(j.a)({},e),{},{children:"Select Account Type"})),Object(U.jsxs)(_t.a,Object(j.a)(Object(j.a)({},e),{},{children:[Object(U.jsx)(I.a,{className:t.paragraph,children:"Please choose an account type to continue."}),Object(U.jsx)(T.a,{className:t.button,onClick:c,children:"Anonymous"}),Object(U.jsx)(T.a,{variant:"contained",color:"primary",onClick:s,children:"Email"})]}))]})})),zt=n(278),Vt=new(n.n(zt).a),Jt=Object(C.a)((function(e){return{button:{marginRight:e.spacing(1)},paragraph:{marginBottom:e.spacing(1)}}})),Xt=Object(O.memo)((function(e){var t=Jt(),n=Mn().setPuk,a=Ht(),r=a.setAccountType,c=a.setCurrentStep,s=a.setUnlockKey,o=Object(O.useCallback)((function(){r(void 0),c((function(e){return e-1}))}),[r,c]),i=Object(O.useCallback)((function(){var e=Vt.sentence({words:5,punctuation:!1}).toLocaleLowerCase();n(e),s(e),c((function(e){return e+1}))}),[c,n,s]);return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(Bt.a,Object(j.a)(Object(j.a)({},e),{},{children:"Anonymous Account"})),Object(U.jsxs)(_t.a,Object(j.a)(Object(j.a)({},e),{},{children:[Object(U.jsx)(I.a,{className:t.paragraph,children:"An anonymous account, only available during this session will be created for you. Data may be deleted at anytime with or without notice, or on a loss of session/appdata, etc."}),Object(U.jsx)(I.a,{className:t.paragraph,children:"Consider using an email/password for cross-device use."}),Object(U.jsx)(I.a,{className:t.paragraph,children:"Do you wish to continue?"}),Object(U.jsx)(T.a,{className:t.button,onClick:o,children:"Back"}),Object(U.jsx)(T.a,{variant:"contained",color:"primary",onClick:i,children:"Next"})]}))]})})),$t=Object(C.a)((function(e){return{unlock:{filter:"blur(5px)",transition:"filter .1s ease","&:hover":{filter:"none"}},button:{marginRight:e.spacing(1)},paragraph:{marginBottom:e.spacing(1)},paper:{padding:e.spacing(2),textAlign:"center"}}})),Qt=Object(O.memo)((function(e){var t=$t(),n=Mn(),a=n.puk,r=n.setPuk,c=Ht(),s=c.accountType,o=c.setCurrentStep,i=c.actions,l=c.setUnlockKey,u=Object(O.useCallback)((function(){"anonymous"===s&&(r(""),l("")),o((function(e){return e-1}))}),[s,o,r,l]);return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(Bt.a,Object(j.a)(Object(j.a)({},e),{},{children:"Generate CryptoKeyPair"})),Object(U.jsxs)(_t.a,Object(j.a)(Object(j.a)({},e),{},{children:[Object(U.jsxs)(N.a,{marginBottom:2,children:[Object(U.jsx)(I.a,{className:t.paragraph,children:"A CryptoKeyPair will be created and encrypted/signed for you using the provided key:"}),Object(U.jsxs)(w.a,{className:t.paper,elevation:0,children:[Object(U.jsx)(I.a,{variant:"h6",className:t.unlock,children:a}),Object(U.jsx)(I.a,{variant:"caption",color:"textSecondary",children:"touch to reveal*"})]}),Object(U.jsx)(I.a,{className:t.paragraph,children:"account"===s&&Object(U.jsxs)(U.Fragment,{children:['If you entered the wrong key, press "',Object(U.jsx)("strong",{children:"Back"}),'" and use a different one.']})}),Object(U.jsxs)(I.a,{className:t.paragraph,children:["Please store this in a safe place as you will ",Object(U.jsx)("strong",{children:"NEVER"})," be able to recover it. If your forget or lose it your account is useless."]})]}),Object(U.jsx)(T.a,{className:t.button,onClick:u,children:"Back"}),Object(U.jsx)(T.a,{variant:"contained",color:"primary",onClick:i.complete,children:"Complete"})]}))]})})),Zt=Object(C.a)((function(e){return{form:{width:"100%"},button:{marginRight:e.spacing(1)},box:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},paragraph:{marginBottom:e.spacing(1)}}})),en={required:!0,fullWidth:!0},tn=k.a({email:k.b().email().trim().required(),password:k.b().min(8).trim().required()}),nn="accountForm",an=Object(O.memo)((function(e){var t=Zt(),n=Object(V.b)(),a=xn(),r=Ht(),c=r.accountMode,s=r.setAccountMode,o=r.setAccountType,i=r.setCurrentStep,l=r.email,u=r.setEmail,h=r.password,m=r.setPassword,f=Object(O.useState)({email:"",password:""}),x=Object(p.a)(f,1)[0],g=Object(O.useCallback)((function(){o(void 0),i((function(e){return e-1}))}),[o,i]),v=Object(O.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t,r){var s,o,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.email,o=t.password,l=r.setSubmitting,e.prev=2,e.t0=c,e.next="login"===e.t0?6:9;break;case 6:return e.next=8,a.auth().signInWithEmailAndPassword(s,o);case 8:return e.abrupt("break",9);case 9:i((function(e){return e+1})),e.next=16;break;case 12:e.prev=12,e.t1=e.catch(2),n.enqueueSnackbar(e.t1.message,{variant:"error"}),l(!1);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t,n){return e.apply(this,arguments)}}(),[c,a,i,n]),y=Object(O.useCallback)((function(){s("login"===c?"create":"login")}),[c,s]),k=Object(O.useCallback)(Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.auth().sendPasswordResetEmail(l);case 3:n.enqueueSnackbar("Message sent. Please check your email.",{variant:"success"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n.enqueueSnackbar(e.t0.message,{variant:"error"});case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),[l,a,n]);return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(Bt.a,Object(j.a)(Object(j.a)({},e),{},{children:"Email Account"})),Object(U.jsxs)(_t.a,Object(j.a)(Object(j.a)({},e),{},{children:[Object(U.jsx)(I.a,{className:t.paragraph,children:"Please enter your credentials to continue."}),Object(U.jsx)(N.a,{marginBottom:1,className:t.box,children:Object(U.jsxs)(D,{className:t.form,id:nn,initialValues:x,validationSchema:tn,onSubmit:v,validate:function(e){var t=e.email,n=e.password;u(t),m(n)},children:[Object(U.jsx)(Y,{id:"email",name:"email",label:"email",FormControlProps:en}),Object(U.jsx)(Y,{id:"password",name:"password",label:"password",FormControlProps:en,InputProps:{type:"password"}}),"create"===c&&Object(U.jsx)(wt,{password:h})]})}),Object(U.jsxs)(N.a,{marginBottom:1,className:t.box,children:[Object(U.jsx)(T.a,{color:"secondary",onClick:k,children:"Reset Password"}),"login"===c?Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(I.a,{variant:"body2",children:"Don't have an account?"}),Object(U.jsx)(T.a,{variant:"text",color:"primary",onClick:y,children:"Create Account"})]}):Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(I.a,{variant:"body2",children:"Already have an account?"}),Object(U.jsx)(T.a,{variant:"text",color:"primary",onClick:y,children:"Use Existing"})]})]}),Object(U.jsx)(T.a,{className:t.button,onClick:g,children:"Back"}),Object(U.jsx)(T.a,{variant:"contained",form:nn,color:"primary",type:"submit",children:"Next"})]}))]})})),rn=Object(C.a)((function(e){return{form:{width:"100%"},button:{marginRight:e.spacing(1)},box:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},paragraph:{marginBottom:e.spacing(1)}}})),cn={required:!0,fullWidth:!0},sn=k.a({puk:k.b().min(8,"PUK must be at least 8 characters").trim().required("PUK is required to send, recieve messages, and generate a CrytopKeyPair")}),on="pukForm",ln=Object(O.memo)((function(e){var t=rn(),n=Object(V.b)(),a=y(),r=Mn(),c=r.puk,s=r.privateKey,o=r.publicKey,i=r.publicKeys,l=r.setPuk,u=Sn(),h=u.userAuth,m=u.userIsAuthenticated,f=Object(O.useState)({puk:m&&null!==c&&void 0!==c?c:""}),x=Object(p.a)(f,2),g=x[0],v=x[1],k=Ht(),C=k.isNewUser,S=k.setCurrentStep,w=k.unlockKey,E=k.setUnlockKey,A=k.setCompleted;Object(O.useEffect)((function(){v({puk:null!==c&&void 0!==c?c:""}),c||E("")}),[c,E]);var R=Object(O.useCallback)((function(){l(""),E(""),S((function(e){return e-1}))}),[S,l,E]),P=Object(O.useCallback)(function(){var e=Object(b.a)(d.a.mark((function e(t,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.setSubmitting,C){e.next=10;break}return e.next=4,Object(ve.computeSharedKeyString)(t.puk,null===s||void 0===s?void 0:s.value,null===h||void 0===h?void 0:h.uid,i);case 4:if(e.sent){e.next=8;break}return n.enqueueSnackbar("Encryption check failed. Is your PUK correct?",{variant:"error"}),e.abrupt("return");case 8:A(!0),a.setItem("setupComplete","true");case 10:l(t.puk),S((function(e){return e+(C?1:2)}));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[C,l,S,null===s||void 0===s?void 0:s.value,null===h||void 0===h?void 0:h.uid,i,A,a,n]);return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)(Bt.a,Object(j.a)(Object(j.a)({},e),{},{children:["Enter ",Object(U.jsx)("strong",{children:"P"}),"ersonal ",Object(U.jsx)("strong",{children:"U"}),"nlock ",Object(U.jsx)("strong",{children:"K"}),"ey"]})),Object(U.jsxs)(_t.a,Object(j.a)(Object(j.a)({},e),{},{children:[Object(U.jsxs)(I.a,{className:t.paragraph,children:["Your PUK is used to secure your ",Object(U.jsx)("strong",{children:"CryptoKeyPair"})," and send/receive messsages."]}),Object(U.jsxs)(N.a,{marginBottom:2,children:[Object(U.jsxs)(I.a,{className:t.paragraph,children:["Please enter ",Object(U.jsx)("strong",{children:"P"}),"ersonal ",Object(U.jsx)("strong",{children:"U"}),"nlock ",Object(U.jsx)("strong",{children:"K"}),"ey (PUK)."]}),Object(U.jsx)(D,{className:t.form,id:on,initialValues:g,onSubmit:P,validationSchema:sn,validate:function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.puk,E(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:Object(U.jsx)(Y,{id:"puk",name:"puk",label:"Private Unlock Key",FormControlProps:cn,InputProps:{type:"password"}})}),!s&&!o&&Object(U.jsx)(wt,{password:w})]}),!m&&Object(U.jsx)(T.a,{className:t.button,onClick:R,children:"Back"}),Object(U.jsx)(T.a,{type:"submit",form:on,variant:"contained",color:"primary",children:s?"Complete":"Next"})]}))]})})),un=Object(C.a)((function(e){return{paper:{padding:e.spacing(2)},paragraph:{marginBottom:e.spacing(1)}}})),dn=Object(O.memo)((function(e){var t=un(),n=Mn(),a=n.puk,r=n.privateKey,c=Ht(),s=c.currentStep,o=c.accountType,i=c.setCurrentStep,l=Object(O.useState)(!1),u=Object(p.a)(l,2),d=u[0],j=u[1],b=Object(O.useCallback)((function(){j(!1)}),[]),h=Object(O.useCallback)((function(){j(!0)}),[]),m=Object(O.useState)(!1),f=Object(p.a)(m,2),x=f[0],g=f[1],v=Object(O.useCallback)((function(){g(!1)}),[]),y=Object(O.useCallback)((function(){g(!0)}),[]);return Object(U.jsxs)(S.a,{maxWidth:"sm",children:[Object(U.jsx)(le,{className:t.paper,elevation:1,children:Object(U.jsxs)(Ft.a,{activeStep:s,orientation:"vertical",children:[Object(U.jsxs)(Kt.a,{completed:s>0,children:[Object(U.jsx)(Bt.a,{children:"Notice"}),Object(U.jsxs)(_t.a,{children:[Object(U.jsx)(N.a,{marginBottom:2,children:Object(U.jsxs)(I.a,{className:t.paragraph,children:["In using this application you agree to the"," ",Object(U.jsx)(et.a,{style:{cursor:"pointer"},onClick:h,children:"terms"})," ","and"," ",Object(U.jsx)(et.a,{style:{cursor:"pointer"},onClick:y,children:"privacy"})," ","policies set forth."]})}),Object(U.jsx)(T.a,{variant:"contained",color:"primary",onClick:function(){i((function(e){return e+1}))},children:"Agree"})]})]}),Object(U.jsx)(Kt.a,{completed:s>1,children:Object(U.jsx)(qt,{})}),"anonymous"===o&&Object(U.jsx)(Kt.a,{completed:s>2,children:Object(U.jsx)(Xt,{})}),"account"===o&&Object(U.jsx)(Kt.a,{completed:s>2,children:Object(U.jsx)(an,{})}),"account"===o&&Object(U.jsx)(Kt.a,{completed:s>3||!!a,children:Object(U.jsx)(ln,{})}),Object(U.jsx)(Kt.a,{completed:!!r,children:Object(U.jsx)(Qt,{})})]})}),Object(U.jsx)(ee,{open:x,onClose:v}),Object(U.jsx)(ne,{open:d,onClose:b})]})})),jn=Object(C.a)((function(e){return{container:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}}})),bn=function(){var e=jn();return y().setItem("setupComplete","false"),Object(U.jsx)("div",{className:e.container,children:Object(U.jsx)(Wt,{children:Object(U.jsx)(dn,{})})})},pn=m.a.initializeApp({apiKey:"AIzaSyABI9FFOHDPRFCPV6nPvj3E9UWBeEcoAIU",authDomain:"kodeniks-studio.firebaseapp.com",projectId:"kodeniks-studio",storageBucket:"kodeniks-studio.appspot.com",messagingSenderId:"608012309662",appId:"1:608012309662:web:18cda65f30eef5cb07178f",measurementId:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyABI9FFOHDPRFCPV6nPvj3E9UWBeEcoAIU",REACT_APP_FIREBASE_AUTH_DOMAIN:"kodeniks-studio.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"kodeniks-studio",REACT_APP_FIREBASE_STORAGE_BUCKET:"kodeniks-studio.appspot.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"608012309662",REACT_APP_FIREBASE_APP_ID:"1:608012309662:web:18cda65f30eef5cb07178f"}).REACT_APP_FIREBASE_MEASUREMENT_ID}),On=pn.firestore(),hn=Object(O.createContext)(void 0),mn=function(e){var t=e.children,n=Object(O.useState)({app:pn,database:On}),a=Object(p.a)(n,1)[0];return Object(U.jsx)(hn.Provider,{value:a,children:t})},fn=function(){var e=Object(O.useContext)(hn);if(!e)throw new Error("You must wrap your component in an FirebaseContextProvider");return e},xn=function(){return fn().app},gn=function(){return fn().database},vn=function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,On.collection("messages").add(t);case 2:return e.next=4,On.collection("users").doc(t.sender).set({lastActivity:Date.now()},{merge:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),yn=function(){var e=Object(b.a)(d.a.mark((function e(t){var n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.privateKey,a=t.publicKey,e.next=3,On.collection("privateKeys").add(n);case 3:return e.next=5,On.collection("publicKeys").add(a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),kn=function(){var e=Object(b.a)(d.a.mark((function e(t){var n,a,r,c,s,o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=On.batch(),e.next=3,On.collection("messages").where("sender","==",t.uid);case 3:return r=e.sent,e.next=6,r.get();case 6:return e.sent.docs.forEach((function(e){return a.delete(e.ref)})),e.next=10,On.collection("messages").where("recipient","==",t.uid);case 10:return c=e.sent,e.next=13,c.get();case 13:return e.sent.docs.forEach((function(e){return a.delete(e.ref)})),e.next=17,On.collection("privateKeys").where("owner","==",t.uid);case 17:return s=e.sent,e.next=20,s.get();case 20:return e.sent.docs.forEach((function(e){return a.delete(e.ref)})),e.next=24,On.collection("publicKeys").where("owner","==",t.uid);case 24:return o=e.sent,e.next=27,o.get();case 27:return e.sent.docs.forEach((function(e){return a.delete(e.ref)})),e.next=31,On.collection("users").where("uid","==",t.uid);case 31:return i=e.sent,e.next=34,i.get();case 34:return e.sent.docs.forEach((function(e){return a.delete(e.ref)})),e.next=38,a.commit();case 38:return e.next=40,null===(n=m.a.auth().currentUser)||void 0===n?void 0:n.delete();case 40:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Cn=Object(O.createContext)(void 0),Sn=function(){var e=Object(O.useContext)(Cn);if(!e)throw new Error("You must wrap your component in an AppContextProvider");return e},wn=function(e){var t=e.children,n=gn(),a=Object(O.useState)(void 0),r=Object(p.a)(a,2),c=r[0],s=r[1],o=function(){var e=gn(),t=Object(O.useState)((function(){return m.a.auth()})),n=Object(p.a)(t,1)[0],a=Object(O.useState)(n.currentUser),r=Object(p.a)(a,2),c=r[0],s=r[1],o=Object(O.useState)(!0),i=Object(p.a)(o,2),l=i[0],u=i[1],j=Object(O.useCallback)(function(){var t=Object(b.a)(d.a.mark((function t(n){var a,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.uid,r=n.displayName,t.next=3,e.collection("users").doc(n.uid).set({displayName:r,uid:a,lastActivity:Date.now()},{merge:!0});case 3:s(n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]);return Object(O.useEffect)((function(){var e,t=n.onAuthStateChanged((function(t){t?j(t):s(null),e=window.setTimeout((function(){return u(!1)}),1e3)}));return function(){t(),clearTimeout(e)}}),[n,j]),{user:c,loading:l}}(),i=o.user,l=o.loading;Object(O.useEffect)((function(){i?function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.collection("users").doc(i.uid).get();case 2:(t=e.sent).exists&&s(Object(j.a)(Object(j.a)({},t.data()),{},{id:t.id}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()():s(void 0)}),[n,i]);var u=Object(O.useMemo)((function(){return n.collection("users").orderBy("lastActivity","desc")}),[n]),h=x(u).docs,f=Boolean(i)&&!l,g=Object(O.useState)({userAuth:i,user:c,users:h,loading:l,userIsAuthenticated:f}),v=Object(p.a)(g,2),y=v[0],k=v[1];return Object(O.useEffect)((function(){k({userAuth:i,user:c,users:h,loading:l,userIsAuthenticated:f})}),[i,c,h,l,f]),Object(U.jsx)(he,{loading:l,children:Object(U.jsx)(Cn.Provider,{value:y,children:t})})},Nn=function(){return Sn().userAuth},In=function(){return Sn().users},En=n(279),Tn=n(580),An=n(581),Rn=Object(O.createContext)(void 0),Pn=function(e){var t,n=e.children,a=Object(Q.a)(),r=y(),c=Object(V.b)(),s=Object(O.useState)(null!==(t=r.getItem("themeType"))&&void 0!==t?t:"dark"),o=Object(p.a)(s,2),i=o[0],l=o[1];r.setItem("themeType",i);var u=Object(O.useMemo)((function(){return{toggleTheme:function(){l("dark"===i?"light":"dark"),c.enqueueSnackbar("Theme updated.",{variant:"success"})}}}),[c,i]),d=Object(En.a)(function(e){return{dark:{palette:{type:"dark",background:{default:e.palette.common.black,paper:e.palette.grey[900]}}},light:{palette:{type:"light",background:{default:"#d2d2d2"}}}}}(a)[i]),j=Object(O.useState)({themeType:i,actions:u}),b=Object(p.a)(j,2),h=b[0],m=b[1];return Object(O.useEffect)((function(){m({themeType:i,actions:u})}),[i,u]),Object(U.jsx)(Rn.Provider,{value:h,children:Object(U.jsxs)(Tn.a,{theme:d,children:[Object(U.jsx)(An.a,{}),n]})})},Un=function(){var e=Object(O.useContext)(Rn);if(!e)throw new Error("You must wrap your component in an AppThemeContextProvider");return e},Dn=Object(O.createContext)(void 0),Ln=function(e){var t=e.children,n=Nn(),a=gn(),r=Object(O.useState)(),c=Object(p.a)(r,2),s=c[0],o=c[1],i=Object(O.useMemo)((function(){return n?a.collection("publicKeys"):a.collection("noop")}),[a,n]),l=x(i).docs,u=Object(O.useMemo)((function(){return n?a.collection("privateKeys").where("owner","==",n.uid):a.collection("noop")}),[a,n]),d=x(u),j=d.docs,b=d.loading,h=Object(O.useMemo)((function(){return j.find((function(e){return e.owner===(null===n||void 0===n?void 0:n.uid)}))}),[n,j]),m=Object(O.useMemo)((function(){return l.find((function(e){return e.owner===(null===n||void 0===n?void 0:n.uid)}))}),[n,l]);Object(O.useEffect)((function(){n||o((function(){}))}),[a,n]);var f=!b,g=Object(O.useState)({puk:s,privateKey:h,publicKey:m,publicKeys:l,setPuk:o}),v=Object(p.a)(g,2),y=v[0],k=v[1];return Object(O.useEffect)((function(){k({puk:s,privateKey:h,publicKey:m,publicKeys:l,setPuk:o})}),[s,h,m,l]),f?Object(U.jsx)(Dn.Provider,{value:y,children:t}):null},Mn=function(){var e=Object(O.useContext)(Dn);if(!e)throw new Error("You must wrap your component in an SecurityContextProvider");return e},Fn=n(582),Kn=n(583),Bn=n(584),_n=n(585),Yn=n(586),Wn=n(587),Hn=n(588),Gn=n(589),qn=Object(C.a)((function(e){return{landscape:{height:"100%",display:"grid",gridTemplateRows:"4em 1fr 4em",gridTemplateColumns:"max-content 28em 1fr",gridTemplateAreas:'\n      "nav nav-pane action-pane"\n      "nav nav-pane action-pane"\n      "nav nav-pane action-pane"\n    '},navigation:{gridArea:"nav",display:"flex",flexDirection:"column",width:e.spacing(8),backgroundColor:e.palette.background.paper,alignContent:"center",zIndex:1,boxShadow:"0 0 5px ".concat(e.palette.primary.light)},tabsRoot:{flexGrow:1,backgroundColor:e.palette.background.paper,width:"100%"},tabsFlexContainerVertical:{height:"100%"},tabRoot:Object(me.a)({maxWidth:e.spacing(8),minWidth:e.spacing(8)},e.breakpoints.up("sm"),{minWidth:e.spacing(8)}),grow:{flexGrow:1},navigationPane:{gridArea:"nav-pane",display:"flex",flexDirection:"column",width:"100%",backgroundColor:e.palette.background.paper,alignContent:"center",zIndex:0},actionPane:{gridArea:"action-pane",display:"flex",flexDirection:"column",width:"100%",backgroundColor:e.palette.background.paper,alignContent:"center",zIndex:1,boxShadow:"0 0 5px ".concat(e.palette.primary.light)},lock:{height:"calc(100% - 4em)",display:"flex",justifyContent:"center",alignItems:"center"},messageLock:{margin:e.spacing(0,1)},marginBottom:{margin:e.spacing(0,1)},container:{padding:e.spacing(1,2)}}})),zn=function(){var e=qn(),t=Sn(),n=t.user,a=t.userAuth,r=Mn(),c=r.puk,s=r.setPuk,o=Un(),i=o.themeType,l=o.actions.toggleTheme,u=Object(V.b)(),j=Object(ae.g)(),h=Object(O.useCallback)((function(){return l()}),[l]),f=Object(O.useState)(1),x=Object(p.a)(f,2),g=x[0],v=x[1],y=Object(O.useCallback)((function(){s("")}),[s]),k=Object(O.useState)(""),C=Object(p.a)(k,2),w=C[0],T=C[1],A=Object(O.useState)(),R=Object(p.a)(A,2),P=R[0],D=R[1],L=Boolean(P),M=function(){D(void 0)},F=Object(O.useState)(!1),K=Object(p.a)(F,2),B=K[0],_=K[1],Y=Object(O.useCallback)((function(){_(!1),j.push("/app")}),[j]),W=Object(O.useCallback)((function(){_(!1),j.push("/app")}),[j]),H=Object(O.useCallback)(Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(null===a||void 0===a?void 0:a.isAnonymous)){e.next=6;break}_(!0),M(),e.next=9;break;case 6:return e.next=8,m.a.auth().signOut();case 8:j.push("/app");case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),u.enqueueSnackbar(e.t0.message,{variant:"error"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),[j,u,null===a||void 0===a?void 0:a.isAnonymous]),G=Object(O.useMemo)((function(){return c?Object(U.jsx)(Ze,{value:g,index:1,setSelectedUserID:T}):Object(U.jsx)(Tt,{value:g,index:1,children:Object(U.jsx)(Mt,{})})}),[g,c]);return Object(U.jsxs)("div",{className:e.landscape,children:[Object(U.jsxs)("div",{className:e.navigation,children:[Object(U.jsx)(E.a,{className:e.messageLock,color:"inherit",onClick:y,children:c?Object(U.jsx)(Fn.a,{}):Object(U.jsx)(Kn.a,{})}),Object(U.jsx)("div",{className:e.grow}),Object(U.jsxs)(we.a,{value:g,onChange:function(e,t){return v(t)},classes:{root:e.tabsRoot,flexContainer:e.tabsFlexContainerVertical},orientation:"vertical",children:[Object(U.jsx)(Ae.a,{id:"tab-0","aria-controls":"tabpanel-0",classes:{root:e.tabRoot},icon:Object(U.jsx)(Bn.a,{}),"aria-label":"favorite"}),Object(U.jsx)(Ae.a,{id:"tab-1","aria-controls":"tabpanel-1",classes:{root:e.tabRoot},icon:Object(U.jsx)(_n.a,{}),"aria-label":"favorite"}),Object(U.jsx)(Ae.a,{id:"tab-2",disabled:!0,"aria-controls":"tabpanel-2",classes:{root:e.tabRoot},icon:Object(U.jsx)(Yn.a,{}),"aria-label":"favorite"})]}),Object(U.jsx)("div",{className:e.grow}),Object(U.jsx)(E.a,{className:e.marginBottom,disabled:!0,color:"inherit",children:Object(U.jsx)(Wn.a,{})}),Object(U.jsx)(E.a,{className:e.marginBottom,color:"inherit",onClick:h,children:"dark"===i?Object(U.jsx)(Hn.a,{}):Object(U.jsx)(Gn.a,{})}),Object(U.jsx)(E.a,{onClick:function(e){D(e.currentTarget)},children:Object(U.jsx)(We,{user:n})}),Object(U.jsx)(Ee.a,{anchorEl:P,keepMounted:!0,open:L,onClose:M,children:Object(U.jsx)(Te.a,{onClick:H,children:"Logout"})})]}),Object(U.jsxs)("div",{className:e.navigationPane,children:[Object(U.jsxs)(Tt,{value:g,index:0,children:[Object(U.jsx)(S.a,{className:e.container,children:Object(U.jsx)(N.a,{mb:1,children:Object(U.jsx)(I.a,{variant:"h5",children:"Profile"})})}),Object(U.jsx)(ie,{})]}),G,Object(U.jsx)(Tt,{value:g,index:2,children:Object(U.jsx)(S.a,{className:e.container,children:Object(U.jsx)(I.a,{variant:"h5",children:"Settings"})})})]}),Object(U.jsxs)("div",{className:e.actionPane,children:[c&&Object(U.jsx)(mt,{selectedUserID:w}),!c&&Object(U.jsx)("div",{className:e.lock,children:Object(U.jsx)(Kn.a,{style:{fontSize:"8em"}})})]}),Object(U.jsx)(te,{open:B,onCancel:W,onConfirm:Y})]})},Vn=n(590),Jn=n(599),Xn=n(591),$n=Object(C.a)((function(e){return{container:{padding:e.spacing(1,2)},portrait:{height:"100%",display:"grid",gridTemplateRows:"1fr 4em",gridTemplateAreas:'\n      "nav-pane"\n      "nav"\n    '},drawerPaper:{width:"100%",backgroundColor:e.palette.background.paper},navigation:{gridArea:"nav",display:"flex",backgroundColor:e.palette.background.paper,alignContent:"center",zIndex:1,boxShadow:"0 0 5px ".concat(e.palette.primary.light)},tabsRoot:{flexGrow:1,backgroundColor:"transparent",width:"100%"},tabsFlexContainerHorizontal:{width:"100%"},tabRoot:Object(me.a)({maxWidth:e.spacing(8),minWidth:e.spacing(8)},e.breakpoints.up("sm"),{minWidth:e.spacing(8)}),grow:{flexGrow:1},toolbar:e.mixins.toolbar,themeToggle:{margin:e.spacing(0,1)},messageLock:{margin:e.spacing(0,1)}}})),Qn=function(){var e=$n(),t=Sn().userAuth,n=Mn(),a=n.puk,r=n.setPuk,c=Un(),s=c.themeType,o=c.actions.toggleTheme,i=Object(V.b)(),l=Object(ae.g)(),u=Object(O.useCallback)((function(){return o()}),[o]),j=Object(O.useState)(1),h=Object(p.a)(j,2),f=h[0],x=h[1],g=Object(O.useCallback)((function(){r("")}),[r]),v=Object(O.useState)(""),y=Object(p.a)(v,2),k=y[0],C=y[1],w=Object(O.useState)(),T=Object(p.a)(w,2),A=T[0],R=T[1],P=Boolean(A),D=function(){R(void 0)},L=Object(O.useState)(!1),M=Object(p.a)(L,2),F=M[0],K=M[1],B=Object(O.useCallback)((function(){K(!1),l.push("/app")}),[l]),_=Object(O.useCallback)((function(){K(!1),l.push("/app")}),[l]),Y=Object(O.useCallback)(Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(null===t||void 0===t?void 0:t.isAnonymous)){e.next=6;break}K(!0),D(),e.next=9;break;case 6:return e.next=8,m.a.auth().signOut();case 8:l.push("/app");case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),i.enqueueSnackbar(e.t0.message,{variant:"error"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),[l,i,null===t||void 0===t?void 0:t.isAnonymous]),W=Object(O.useState)(!1),H=Object(p.a)(W,2),G=H[0],q=H[1],z=Object(O.useCallback)((function(){}),[]),J=Object(O.useCallback)((function(){q(!1)}),[]),X=Object(O.useCallback)((function(e){q(!0)}),[]),$=Object(O.useMemo)((function(){return a?Object(U.jsx)(Ze,{value:f,index:1,setSelectedUserID:C,onChatItemClicked:X}):Object(U.jsx)(Tt,{value:f,index:1,children:Object(U.jsx)(Mt,{})})}),[f,X,a]);return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(Vn.a,{position:"fixed",color:"default",style:{top:"auto",bottom:0},children:Object(U.jsxs)(pt.a,{children:[Object(U.jsx)(E.a,{className:e.messageLock,color:"inherit",onClick:g,children:a?Object(U.jsx)(Fn.a,{}):Object(U.jsx)(Kn.a,{})}),Object(U.jsx)("div",{className:e.grow}),Object(U.jsxs)(we.a,{value:f,onChange:function(e,t){return x(t)},classes:{root:e.tabsRoot,flexContainer:e.tabsFlexContainerHorizontal},orientation:"horizontal",children:[Object(U.jsx)(Ae.a,{id:"tab-0","aria-controls":"tabpanel-0",classes:{root:e.tabRoot},icon:Object(U.jsx)(Bn.a,{}),"aria-label":"favorite"}),Object(U.jsx)(Ae.a,{id:"tab-1","aria-controls":"tabpanel-1",classes:{root:e.tabRoot},icon:Object(U.jsx)(_n.a,{}),"aria-label":"favorite"})]}),Object(U.jsx)("div",{className:e.grow}),Object(U.jsx)(E.a,{className:e.themeToggle,color:"inherit",onClick:u,children:"dark"===s?Object(U.jsx)(Hn.a,{}):Object(U.jsx)(Gn.a,{})}),Object(U.jsx)(E.a,{onClick:function(e){R(e.currentTarget)},children:Object(U.jsx)(Ne.a,{})}),Object(U.jsxs)(Ee.a,{anchorEl:A,keepMounted:!0,open:P,onClose:D,children:[Object(U.jsx)(Te.a,{disabled:!0,onClick:Y,children:"Settings"}),Object(U.jsx)(Te.a,{disabled:!0,onClick:Y,children:"Language"}),Object(U.jsx)(Te.a,{onClick:Y,children:"Logout"})]})]})}),Object(U.jsxs)(Tt,{value:f,index:0,children:[Object(U.jsx)(S.a,{className:e.container,children:Object(U.jsx)(N.a,{mb:1,children:Object(U.jsx)(I.a,{variant:"h5",children:"Profile"})})}),Object(U.jsx)(ie,{})]}),$,Object(U.jsx)(Tt,{value:f,index:2,children:Object(U.jsx)(S.a,{className:e.container,children:Object(U.jsx)(I.a,{variant:"h5",children:"Settings"})})}),Object(U.jsx)(Jn.a,{classes:{paper:e.drawerPaper},anchor:"right",open:G,onOpen:z,onClose:J,children:Object(U.jsx)(mt,{backAction:Object(U.jsx)(E.a,{onClick:J,children:Object(U.jsx)(Xn.a,{})}),selectedUserID:k})}),Object(U.jsx)("div",{className:e.toolbar}),Object(U.jsx)(te,{open:F,onCancel:_,onConfirm:B})]})},Zn=function(){var e=Object(Q.a)(),t=Sn().userIsAuthenticated,n=Mn(),a=n.puk,r=n.privateKey,c=Object(Z.a)(e.breakpoints.down("sm")),s=y(),o=Object(O.useMemo)((function(){return t&&r&&(a||"true"===s.getItem("setupComplete"))?c?Object(U.jsx)(Qn,{}):Object(U.jsx)(zn,{}):Object(U.jsx)(bn,{})}),[t,r,a,s,c]);return Object(U.jsx)(U.Fragment,{children:o})},ea=n(25),ta=n(46),na=n(47),aa=function(e){Object(ta.a)(n,e);var t=Object(na.a)(n);function n(){var e;Object(g.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={error:!1},e}return Object(ea.a)(n,[{key:"componentDidMount",value:function(){var e=Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ve.generateCryptoKeyPair)();case 3:return t=e.sent,e.next=6,Object(ve.convertCryptoKeyPairToHex)(t);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.setState({error:!0});case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.error?Object(U.jsx)("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:Object(U.jsxs)(S.a,{maxWidth:"sm",children:[Object(U.jsx)(be,{severity:"error",children:"It looks like you can't be secure using this device."}),Object(U.jsxs)(w.a,{style:{padding:"1em"},children:[Object(U.jsx)(I.a,{children:"Your device doesn't support the needed Cryptographic interfaces needed to be secure."}),Object(U.jsx)(I.a,{children:"For more information on the crytopgraphy used here please visit:"}),Object(U.jsx)(et.a,{target:"_blank",href:"https://en.wikipedia.org/wiki/Elliptic-curve_Diffie%E2%80%93Hellman",children:"Elliptic-curve Diffie\u2013Hellman"})]})]})}):Object(U.jsx)(U.Fragment,{children:this.props.children})}}]),n}(O.Component),ra=function(){var e=Object(Q.a)(),t=Object(Z.a)(e.breakpoints.down("sm")),n=Object(O.useMemo)((function(){return{horizontal:t?"center":"right",vertical:"top"}}),[t]);return Object(U.jsx)(ut.a,{basename:"",children:Object(U.jsx)(V.a,{maxSnack:3,dense:t,anchorOrigin:n,autoHideDuration:2500,preventDuplicate:!0,children:Object(U.jsx)(Pn,{children:Object(U.jsxs)(ae.d,{children:[Object(U.jsx)(ae.b,{exact:!0,path:"/",children:Object(U.jsx)(nt,{})}),Object(U.jsx)(ae.b,{exact:!0,path:"/terms",children:Object(U.jsx)(Rt,{})}),Object(U.jsx)(ae.b,{exact:!0,path:"/privacy",children:Object(U.jsx)(It,{})}),Object(U.jsx)(aa,{children:Object(U.jsx)(mn,{children:Object(U.jsx)(wn,{children:Object(U.jsx)(Ln,{children:Object(U.jsx)(ae.b,{exact:!0,path:"/app",children:Object(U.jsx)(Zn,{})})})})})})]})})})})},ca=n(22),sa=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,605)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))};n.n(ca).a.render(Object(U.jsx)(h.a.StrictMode,{children:Object(U.jsx)(ra,{})}),document.getElementById("root")),sa()}},[[501,1,2]]]);